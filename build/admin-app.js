(()=>{var e,s={766:()=>{(()=>{var e={766:()=>{(()=>{"use strict";var e,s={435:()=>{const e=window.wp.element,s=window.wp.components,t=window.ReactJSXRuntime,n=({content:e,placement:n="top",children:i})=>{const a=s?.Tooltip;return a?(0,t.jsx)(a,{text:e,children:i}):(0,t.jsx)("span",{className:`dbvc-tooltip dbvc-tooltip--${n}`,"data-tooltip":e||"","aria-label":e||"",children:i})},i=async(e,{signal:s}={})=>{const t=await window.fetch(`${DBVC_ADMIN_APP.root}${e}`,{headers:{"X-WP-Nonce":DBVC_ADMIN_APP.nonce},signal:s});if(!t.ok)throw new Error(`Request failed (${t.status})`);return t.json()},a=async(e,s)=>{const t=await window.fetch(`${DBVC_ADMIN_APP.root}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":DBVC_ADMIN_APP.nonce},body:JSON.stringify(s)});if(!t.ok){const s=await t.text();let n=s;try{n=JSON.parse(s)}catch(e){}const i=new Error(n&&n.message||s||`Request failed (${t.status})`);throw i.status=t.status,i.body=n,i}return t.json()},l=async e=>{const s=await window.fetch(`${DBVC_ADMIN_APP.root}${e}`,{method:"DELETE",headers:{"X-WP-Nonce":DBVC_ADMIN_APP.nonce}});if(!s.ok){const e=await s.text();throw new Error(e||`Request failed (${s.status})`)}return s.json()},r=DBVC_ADMIN_APP?.docs?.masking||(window.location&&window.location.origin?`${window.location.origin.replace(/\/$/,"")}/wp-content/plugins/db-version-control-main/docs/meta-masking.md`:"https://example.com/docs/meta-masking.md"),o=e=>e?`${r}#${e}`:r,c=e=>!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then,d=!1,u=new Set,p=e=>{if(!e)return"—";if(c(e))return"[async]";const s=new Date(e);return Number.isNaN(s.getTime())?e:s.toLocaleString()},h=e=>null==e?"—":c(e)?"[async]":"boolean"==typeof e?e?"true":"false":"number"==typeof e?e.toString():""===e?"(empty)":"string"==typeof e?e:m(e),m=e=>{if(null==e)return"";if(c(e))return d||(d=!0,console.warn("DBVC: Promise detected in entity drawer values. Inspect the data source returning a Promise.",e)),"[async]";if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return String(e);try{return JSON.stringify(e,null,2)}catch(s){return String(e)}},v=e=>e&&(e.diff||e.before||e.after)?(0,t.jsxs)(t.Fragment,{children:[e.before&&(0,t.jsx)("span",{children:e.before}),e.diff&&(0,t.jsx)("mark",{children:e.diff||"(empty)"}),e.after&&(0,t.jsx)("span",{children:e.after})]}):null,b=new Set(["post_title","post_name","post_status","post_type","post_excerpt","post_parent","post_author","post_date","post_date_gmt","post_modified","post_modified_gmt","post_password","post_mime_type","post_content_filtered","menu_order","comment_status","ping_status","guid","comment_count"]),f=new Set(["name","term_name","slug","term_slug","description","parent","parent_slug","taxonomy","term_taxonomy"]),g={meta:"Meta",tax:"Taxonomies",media:"Media References",content:"Content",post_fields:"Post Fields",term_fields:"Term Fields",title:"Title",status:"Status",post_type:"Post Type",post_excerpt:"Excerpt",other:"Other"},_="__dbvc_new_entity__",x={all:"All entities",needs_review:"Needs Review",needs_review_media:"Needs Review (Media)",resolved:"Resolved",reused:"Resolved",conflict:"Conflict",needs_download:"Needs Download",missing:"Missing",unknown:"Unknown",new_entities:"New entities",with_decisions:"With selections",uid_mismatch:"UID mismatch"},j={ignore:"Ignore masked field",auto_accept:"Auto-accept & suppress",override:"Override masked value"},y=e=>{const s=x[e]||e;return(0,t.jsx)("span",{className:`dbvc-badge dbvc-badge--${e}`,children:s})},w=e=>Boolean(void 0!==e?.is_new_entity?e.is_new_entity:"missing_local_post"===e?.diff_state?.reason),k=e=>e?.entity_type?e.entity_type:"string"==typeof e?.post_type&&e.post_type.startsWith("term:")?"term":"post",N=e=>{if("term"===k(e)){const s=(e?.term_taxonomy||e?.post_type||"").replace(/^term:/,"");return h(s?`Term (${s})`:"Term")}return h(e?.post_type||"Post")},C=e=>h("term"===k(e)?"Term":e?.post_status||"—"),S=e=>h("term"===k(e)?e?.term_slug||e?.slug||e?.post_name||"—":e?.post_name||"—"),D=e=>{if("term"===k(e)){const s=e?.name||e?.term_name||e?.post_title||"",t=e?.term_taxonomy||e?.taxonomy||"",n=e?.term_slug||e?.slug||e?.post_name||"";if(s)return h(s);if(t&&n)return h(`${t}/${n}`);if(n)return h(n)}return h(e?.post_title||e?.vf_object_uid||"Entity detail")},$=e=>(e||"").toString().trim().toLowerCase(),A=e=>{if("term"===k(e)){return e?.term_taxonomy||e?.taxonomy||("string"==typeof e?.post_type&&e.post_type.startsWith("term:")?e.post_type.replace(/^term:/,""):"term")}return e?.post_type||"post"},I=e=>{const s=D(e);if(s&&"Entity detail"!==s)return s;const t=S(e);return t&&"—"!==t?t:e?.vf_object_uid||""},R=(e,s)=>e.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"}),E=e=>{if(!Array.isArray(e))return[];const s=[...e];return s.sort((e,s)=>{const t="term"===k(e)?1:0,n="term"===k(s)?1:0;if(t!==n)return t-n;const i=R($(A(e)),$(A(s)));if(i)return i;const a=R($(I(e)),$(I(s)));return a||(R($(S(e)),$(S(s)))||R($(e?.vf_object_uid||""),$(s?.vf_object_uid||"")))}),s},M=[{id:"title",label:"Title",defaultVisible:!0,lockVisible:!0,renderCell:e=>D(e)},{id:"post_name",label:"Slug",defaultVisible:!0,renderCell:e=>(0,t.jsx)("span",{className:"dbvc-text-break",children:S(e)})},{id:"post_type",label:"Type",defaultVisible:!0,renderCell:e=>N(e)},{id:"post_status",label:"Status",defaultVisible:!0,renderCell:e=>C(e)},{id:"post_modified",label:"Last modified",defaultVisible:!0,renderCell:e=>e.post_modified?p(e.post_modified):"—"},{id:"content_hash",label:"Content hash",defaultVisible:!1,renderCell:e=>{var s;return(0,t.jsx)("span",{className:"dbvc-text-break",children:null!==(s=e.content_hash)&&void 0!==s?s:"—"})}},{id:"diff",label:"Diff",defaultVisible:!0,renderCell:(e,s)=>(0,t.jsxs)(t.Fragment,{children:[y(s.diffState.needs_review?"needs_review":"resolved"),s.hashMissing&&(0,t.jsx)("span",{className:"dbvc-badge dbvc-badge--missing",style:{marginLeft:"0.25rem"},children:"Hash missing"}),s.entityHasSelections&&(0,t.jsx)("span",{className:"dbvc-badge dbvc-badge--pending",style:{marginLeft:"0.25rem"},children:"Pending"})]})},{id:"media_refs",label:"Media refs",defaultVisible:!0,renderCell:e=>{var s,t;return(null!==(s=e.media_refs?.meta?.length)&&void 0!==s?s:0)+(null!==(t=e.media_refs?.content?.length)&&void 0!==t?t:0)}},{id:"resolver",label:"Resolver",defaultVisible:!0,renderCell:(e,s)=>{const n=s.isNewEntity,i=s.newDecision||"",a=k(e);let l="term"===a?"New term":"New post";return"accept_new"===i?l="term"===a?"New term accepted":"New post accepted":"decline_new"===i&&(l="term"===a?"New term declined":"New post declined"),(0,t.jsxs)("div",{className:"dbvc-resolver-cell",children:[y(s.mediaStatus),n&&(0,t.jsx)("span",{className:"dbvc-badge dbvc-badge--new"+("decline_new"===i?" is-declined":""),style:{marginLeft:"0.25rem"},children:l})]})}},{id:"unresolved_media",label:"Unresolved media",defaultVisible:!0,renderCell:(e,s)=>{var t;return null!==(t=s.summary.unresolved)&&void 0!==t?t:0}},{id:"meta_diff_count",label:"Unresolved meta",defaultVisible:!0,renderCell:e=>{var s;return null!==(s=e.meta_diff_count)&&void 0!==s?s:0}},{id:"conflicts",label:"Conflicts",defaultVisible:!0,renderCell:(e,s)=>{var t;return null!==(t=s.summary.conflicts)&&void 0!==t?t:0}},{id:"decisions",label:"Decisions",defaultVisible:!0,renderCell:(e,s)=>s.entityHasSelections?(0,t.jsxs)("div",{className:"dbvc-decisions",children:[s.entityAccepted>0&&(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--accept",children:[s.entityAccepted," accept"]}),s.entityNewAccepted>0&&(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--new",children:[s.entityNewAccepted," new"]}),s.entityKept>0&&(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--keep",children:[s.entityKept," keep"]})]}):"—"}],B=({proposals:e,selectedId:n,onSelect:i,onDelete:a,deleteBusyId:l})=>e.length?(0,t.jsx)("div",{className:"dbvc-proposal-table-wrapper",children:(0,t.jsxs)("table",{className:"widefat fixed striped dbvc-proposal-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Proposal"}),(0,t.jsx)("th",{children:"Generated"}),(0,t.jsx)("th",{children:"Files"}),(0,t.jsx)("th",{children:"Media"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Decisions"}),(0,t.jsx)("th",{children:"Resolver reused"}),(0,t.jsx)("th",{children:"Resolver unresolved"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>{var l,r,o,c,d,u,h,m,v,b,f;const g=null!==(l=e.resolver?.metrics)&&void 0!==l?l:{},_=e.id===n,x=null!==(r=e.decisions)&&void 0!==r?r:{},j=null!==(o=x.accepted)&&void 0!==o?o:0,y=null!==(c=x.kept)&&void 0!==c?c:0,w=null!==(d=x.entities_reviewed)&&void 0!==d?d:0,k=(null!==(u=x.total)&&void 0!==u?u:0)>0,N="closed"===e.status?"Closed":"Open";return(0,t.jsxs)("tr",{className:`${_?"is-active":""} ${"closed"===e.status?"is-archived":""}`,onClick:()=>i(e.id),style:{cursor:"pointer"},children:[(0,t.jsx)("td",{children:e.title}),(0,t.jsx)("td",{children:p(e.generated_at)}),(0,t.jsx)("td",{children:null!==(h=e.files)&&void 0!==h?h:"—"}),(0,t.jsx)("td",{children:null!==(m=e.media_items)&&void 0!==m?m:"—"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:`dbvc-status-badge dbvc-status-badge--${null!==(v=e.status)&&void 0!==v?v:"draft"}`,children:N})}),(0,t.jsx)("td",{children:k?(0,t.jsxs)("div",{className:"dbvc-decisions",children:[(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--accept",children:[j," accept"]}),(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--keep",children:[y," keep"]}),w>0&&(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--reviewed",children:[w," reviewed"]})]}):"—"}),(0,t.jsx)("td",{children:null!==(b=g.reused)&&void 0!==b?b:"—"}),(0,t.jsx)("td",{children:null!==(f=g.unresolved)&&void 0!==f?f:"—"}),(0,t.jsx)("td",{className:"dbvc-proposal-table__actions",children:_?"—":(0,t.jsx)(s.Button,{variant:"tertiary",isDestructive:!0,onClick:s=>{s.stopPropagation(),"function"==typeof a&&a(e.id)},disabled:j===e.id||e.locked,title:e.locked?"Locked proposals cannot be deleted.":void 0,children:j===e.id?"Deleting…":"Delete"})})]},e.id)})})]})}):(0,t.jsx)("p",{children:"No proposals found. Generate an export to get started."}),O=({onUploaded:n,onError:i})=>{const[a,l]=(0,e.useState)(!1),[r,o]=(0,e.useState)(!1),[c,d]=(0,e.useState)(""),[u,p]=(0,e.useState)(""),[h,m]=(0,e.useState)(!1),[v,b]=(0,e.useState)(!1),f=(0,e.useRef)(null),g=(0,e.useCallback)(async e=>{const s=e&&e[0];if(!s)return;const t=new window.FormData;t.append("file",s),t.append("overwrite",h?"1":"0"),v&&t.append("fixture_name",s.name),o(!0),d(""),p("");try{const e=await(async(e,s)=>{const t=await window.fetch(`${DBVC_ADMIN_APP.root}${e}`,{method:"POST",headers:{"X-WP-Nonce":DBVC_ADMIN_APP.nonce},body:s});if(!t.ok){const e=await t.text();throw new Error(e||`Request failed (${t.status})`)}return t.json()})(v?"fixtures/upload":"proposals/upload",t);d(`${v?"Saved dev fixture":"Uploaded"} ${s.name}`),v||"function"!=typeof n||n(e.proposal_id,e)}catch(e){const s=e?.message||"Upload failed.";p(s),"function"==typeof i&&i(s)}finally{o(!1),f.current&&(f.current.value="")}},[h,v,n,i]);return(0,t.jsxs)("div",{className:"dbvc-proposal-uploader",children:[(0,t.jsx)("div",{className:`dbvc-proposal-uploader__dropzone${a?" is-dragging":""}${r?" is-uploading":""}`,onDragOver:e=>{e.preventDefault(),l(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||l(!1)},onDrop:e=>{e.preventDefault(),l(!1),g(e.dataTransfer?.files)},children:[(0,t.jsxs)("div",{className:"dbvc-proposal-uploader__body",children:[(0,t.jsxs)("div",{className:"dbvc-proposal-uploader__text",children:[(0,t.jsx)("strong",{children:"Upload proposal bundle"}),(0,t.jsx)("p",{children:"Drop a DBVC ZIP export here or select a file to register it."})]}),(0,t.jsxs)("div",{className:"dbvc-proposal-uploader__actions",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:()=>f.current?.click(),disabled:r,children:r?"Uploading…":"Select ZIP"}),(0,t.jsx)("span",{className:"dbvc-proposal-uploader__actions-note",children:"ZIP files only"}),(0,t.jsx)("input",{ref:f,type:"file",accept:".zip",style:{display:"none"},onChange:e=>g(e.target.files)})]})]}),(0,t.jsxs)("div",{className:"dbvc-proposal-uploader__options",children:[(0,t.jsx)("div",{className:"dbvc-proposal-uploader__option",children:(0,t.jsx)(s.CheckboxControl,{label:"Replace existing proposal when IDs match",help:"Enable if this upload should refresh an existing proposal folder instead of creating a new one.",checked:h,onChange:e=>m(e),disabled:r})}),(0,t.jsx)("div",{className:"dbvc-proposal-uploader__option",children:(0,t.jsx)(s.CheckboxControl,{label:"Dev upload (store ZIP in docs/fixtures)",help:"Copies the selected ZIP into docs/fixtures for local QA. Disable to register the proposal normally.",checked:v,onChange:e=>b(e),disabled:r})})]})]}),c&&(0,t.jsx)("p",{className:"dbvc-proposal-uploader__status",children:c}),u&&(0,t.jsx)("p",{className:"dbvc-proposal-uploader__error",role:"alert",children:u})]})},P=({resolver:e})=>{var s,n,i,a;if(!e)return(0,t.jsx)("p",{children:"Resolver metrics unavailable."});const{metrics:l={},conflicts:r=[]}=e;return(0,t.jsxs)("div",{className:"dbvc-admin-app__resolver",children:[(0,t.jsx)("h3",{children:"Resolver Summary"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:["Detected: ",null!==(s=l.detected)&&void 0!==s?s:0]}),(0,t.jsxs)("li",{children:["Reused: ",null!==(n=l.reused)&&void 0!==n?n:0]}),(0,t.jsxs)("li",{children:["Downloaded: ",null!==(i=l.downloaded)&&void 0!==i?i:0]}),(0,t.jsxs)("li",{children:["Unresolved: ",null!==(a=l.unresolved)&&void 0!==a?a:0]}),(0,t.jsxs)("li",{children:["Conflicts: ",r.length]})]}),r.length>0&&(0,t.jsx)("div",{className:"notice notice-warning",children:(0,t.jsxs)("p",{children:["The resolver reported ",r.length," conflict(s). Review before applying."]})})]})},U=({entities:s,loading:n,selectedEntityId:i,onSelect:a,columns:l,selectedIds:r=new Set,onToggleSelection:o,onToggleSelectionAll:c})=>{if(n)return(0,t.jsx)("p",{children:"Loading entities…"});if(!s.length)return(0,t.jsx)("p",{children:"No entities found for this proposal."});const d=l&&l.length?l:M,u="function"==typeof o,p=r instanceof Set?r:new Set(r),h=s.map(e=>e.vf_object_uid),m=u&&s.length>0&&s.every(e=>p.has(e.vf_object_uid)),v=u&&!m&&s.some(e=>p.has(e.vf_object_uid)),b=(0,e.useRef)(null);return(0,e.useEffect)(()=>{u&&b.current&&(b.current.indeterminate=v)},[u,v]),(0,t.jsx)("div",{className:"dbvc-entity-table",children:(0,t.jsxs)("table",{className:"widefat striped",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[u&&(0,t.jsx)("th",{className:"dbvc-entity-select",children:(0,t.jsx)("input",{type:"checkbox",ref:b,checked:m,onChange:e=>c?.(h,e.target.checked)})}),d.map(e=>(0,t.jsx)("th",{children:e.label},e.id))]})}),(0,t.jsx)("tbody",{children:s.map(e=>{var s,n,l,r,c,h,m,v;const b=e.vf_object_uid===i,f=u&&p.has(e.vf_object_uid),g=null!==(s=e.resolver?.summary)&&void 0!==s?s:{},_=null!==(n=e.diff_state)&&void 0!==n?n:{},x=e.media_needs_review?"needs_review":null!==(l=e.resolver?.status)&&void 0!==l?l:"resolved",j=e.overall_status||(_.needs_review?"needs_review":"resolved"),y="missing_local_hash"===_.reason,k=null!==(r=e.decision_summary)&&void 0!==r?r:{},N=null!==(c=k.accepted)&&void 0!==c?c:0,C=null!==(h=k.kept)&&void 0!==h?h:0,S=null!==(m=k.accepted_new)&&void 0!==m?m:0,D=(null!==(v=k.total)&&void 0!==v?v:0)>0,$=w(e),A=e.new_entity_decision||"",I=e.identity_match||"",R=[`resolver-${j}`,b?"is-active":"",f?"is-selected":""].filter(Boolean).join(" "),E=s=>{s.preventDefault(),s.stopPropagation(),a(e.vf_object_uid)},M={summary:g,diffState:_,mediaStatus:x,hashMissing:y,decisionSummary:k,entityHasSelections:D,entityAccepted:N,entityNewAccepted:S,entityKept:C,isNewEntity:$,newDecision:A,identityMatch:I};return(0,t.jsxs)("tr",{className:R,onClick:E,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||E(e)},style:{cursor:"pointer"},role:"button",tabIndex:0,children:[u&&(0,t.jsx)("td",{className:"dbvc-entity-select",children:(0,t.jsx)("input",{type:"checkbox",checked:f,onChange:s=>{s.stopPropagation(),o?.(e.vf_object_uid)},onClick:e=>e.stopPropagation()})}),d.map(s=>{var n;return(0,t.jsx)("td",{children:s.renderCell?s.renderCell(e,M):null!==(n=e[s.id])&&void 0!==n?r(n):"—"},s.id)})]},e.vf_object_uid)})})]})})},T=({entityDetail:n,resolverInfo:i,resolverDecisionSummary:a=null,decisions:l={},onDecisionChange:r,onBulkDecision:o,onResetDecisions:c,onCaptureSnapshot:d,onResolverDecision:u,onResolverDecisionReset:p,onApplyResolverDecisionToSimilar:h,savingPaths:m={},bulkSaving:v=!1,resolverSaving:x={},resolverError:y=null,decisionError:C,loading:$,error:A,onClose:I,filterMode:R,onFilterModeChange:E,isOpen:M=!0,resettingDecisions:B=!1,snapshotCapturing:O=!1,onHashSync:P,hashSyncing:U=!1,hashSyncTarget:T="",maskFieldsByEntity:F={}})=>{var L,V,z,K,J,W,G,X,Z,Q,Y,ee,se,te,ne;const ie=(0,e.useMemo)(()=>n?.item?.vf_object_uid?`dbvc-entity-detail-${n.item.vf_object_uid}`:n?.vf_object_uid?`dbvc-entity-detail-${n.vf_object_uid}`:"dbvc-entity-detail",[n]),ae=(0,e.useRef)(null),le=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(!I||!M)return;le.current=document.activeElement instanceof HTMLElement?document.activeElement:null;const e=ae.current;e&&e.focus();const s=e=>{"Escape"===e.key&&(e.preventDefault(),I())};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s),le.current&&"function"==typeof le.current.focus&&le.current.focus()}},[M,I,ie]);const{item:re,current:oe,proposed:ce={},diff:de}=null!=n?n:{},ue=null!==(L=n?.decision_summary)&&void 0!==L?L:{},pe=null!==(V=null!==(z=n?.diff_state)&&void 0!==z?z:re?.diff_state)&&void 0!==V?V:null,he=((e,s)=>{if(!s)return"";if("term"===k(e)){const t=e?.term_taxonomy||e?.taxonomy||"";return t?`term.php?taxonomy=${t}&tag_ID=${s}`:`term.php?tag_ID=${s}`}return`post.php?post=${s}&action=edit`})(re,null!==(K=pe?.local_post_id)&&void 0!==K?K:null),me=D(re),ve=S(re),be=(e=>"term"===k(e)?"Term slug:":"Slug:")(re),fe=k(re),ge=re?.term_taxonomy||re?.taxonomy||"",_e=(N(re),"missing_local_hash"===pe?.reason),xe=w(null!=n?n:{diff_state:pe}),je=null!==(J=null!==(W=l?.[_])&&void 0!==W?W:n?.new_entity_decision)&&void 0!==J?J:"",ye=Boolean(m?.[_]),we=null!==(G=ue.total)&&void 0!==G?G:0,ke=we>0?`${null!==(X=ue.accepted)&&void 0!==X?X:0} accepted · ${null!==(Z=ue.kept)&&void 0!==Z?Z:0} kept`:"No selections captured yet.",Ne=null!==(Q=de?.changes)&&void 0!==Q?Q:[],Ce=(0,e.useMemo)(()=>{const e=n?.vf_object_uid||re?.vf_object_uid||"";return e&&F[e]?F[e]:[]},[F,n,re]),Se=(0,e.useMemo)(()=>{if("all"!==R)return[];const e=(s,t="")=>{const n={};return s&&"object"==typeof s?(Object.keys(s).forEach(i=>{const a=s[i],l=t?`${t}.${i}`:String(i);a&&"object"==typeof a?Object.assign(n,e(a,l)):n[l]=void 0===a?null:a}),n):n},s=e(oe?.meta||{},"meta"),t=e(ce?.meta||{},"meta"),n=new Set([...Object.keys(s),...Object.keys(t)]),i=Array.from(n);return i.sort(),i.map(e=>{const n=Object.prototype.hasOwnProperty.call(s,e)?s[e]:null,i=Object.prototype.hasOwnProperty.call(t,e)?t[e]:null;return{path:e,label:e,section:"meta",from:n,to:i,is_equal:o(n)===o(i)}})},[R,oe,ce]),De=(0,e.useMemo)(()=>"all"===R?Se:Ne,[Se,Ne,R]),$e=(0,e.useMemo)(()=>(e=>{const s={};return e.forEach(e=>{const[t]=e.path.split("."),n=(b.has(t)?"post_fields":f.has(t)?"term_fields":t)||"other";s[n]||(s[n]=[]),s[n].push(e)}),Object.entries(s).map(([e,s])=>({key:e,label:g[e]||e,items:s}))})(De),[De]),Ae=null!==(Y=i?.attachments)&&void 0!==Y?Y:[],[Ie,Re]=(0,e.useState)(""),Ee=(0,e.useMemo)(()=>{if(!Ie)return Ae;const e=Ie.toLowerCase();return Ae.filter(s=>{const t=s.descriptor||{};return[s.original_id,s.reason,s.status,s.decision?.note,t.asset_uid,t.bundle_path,t.path].filter(Boolean).join(" ").toLowerCase().includes(e)})},[Ae,Ie]),Me="conflicts"===R,Be=Ne.length,Oe=(0,e.useMemo)(()=>Ne.filter(e=>{var s;return"accept"!==(null!==(s=l?.[e.path])&&void 0!==s?s:"")}).length,[Ne,l]),Pe=De.length,[Ue,Te]=(0,e.useState)(!1),[Fe,Le]=(0,e.useState)(""),[Ve,ze]=(0,e.useState)("reason"),[Ke,He]=(0,e.useState)(""),[Je,qe]=(0,e.useState)(""),[We,Ge]=(0,e.useState)(""),[Xe,Ze]=(0,e.useState)(""),[Qe,Ye]=(0,e.useState)(!1),[es,ss]=(0,e.useState)(!1),[ts,ns]=(0,e.useState)("");(0,e.useEffect)(()=>{Ue||Le($e[0]?.key||"")},[$e,Ue]);const is=(0,e.useMemo)(()=>Ue||!Fe?$e:$e.filter(e=>e.key===Fe),[$e,Ue,Fe]),as=(0,e.useMemo)(()=>{if(Ue)return De;const e=$e.find(e=>e.key===Fe);return e?e.items:[]},[Ue,De,$e,Fe]),ls=(0,e.useMemo)(()=>as.filter(e=>!e.is_equal).map(e=>e.path).filter(Boolean),[as]),rs=(0,e.useMemo)(()=>{const e=new Set,s=new Set,t=new Set;return Ae.forEach(n=>{n.reason&&e.add(n.reason);const i=n.descriptor||{};i.asset_uid&&s.add(i.asset_uid);const a=i.bundle_path||i.path||"";a&&t.add(a)}),{reason:Array.from(e),asset_uid:Array.from(s),bundle_path:Array.from(t)}},[Ae]);(0,e.useEffect)(()=>{const e=rs[Ve]||[];e.length?e.includes(Ke)||He(e[0]||""):He("")},[Ve,Ke,rs]);const os="term"===fe&&ge?`${ge}/${ve}`:ve,cs=re?.term_parent_slug||re?.parent_slug||ce?.parent_slug||oe?.term_parent_slug||oe?.parent_slug||"",ds=re?.term_parent||re?.parent||ce?.parent||oe?.term_parent||oe?.parent||0,us="term"!==fe?null:cs||(re?.term_parent_uid||ce?.parent_uid||oe?.term_parent_uid||"")||(ds?`ID ${ds}`:"—"),ps="term"===fe&&ge?`${me} · ${ge}`:me,hs=(0,e.useMemo)(()=>!Ke&&(rs[Ve]||[]).length?[]:Ae.filter(e=>{const s=e.descriptor||{};switch(Ve){case"asset_uid":return(s.asset_uid||"")===Ke;case"bundle_path":return(s.bundle_path||s.path||"")===Ke;default:return(e.reason||"")===Ke}}),[Ae,Ve,Ke,rs]),ms=hs.length,vs="reuse"===Je||"map"===Je;return I&&!M?null:(e=>{const s=(0,t.jsx)("div",{className:"dbvc-admin-app__entity-detail",children:e});return I?(0,t.jsxs)("div",{className:"dbvc-entity-detail-modal",role:"presentation",children:[(0,t.jsx)("div",{className:"dbvc-entity-detail-modal__overlay",onClick:I,"aria-hidden":"true"}),(0,t.jsx)("div",{className:"dbvc-entity-detail-modal__panel",role:"dialog","aria-modal":"true","aria-labelledby":ie,children:s})]}):s})($?(0,t.jsx)("p",{children:"Loading entity detail…"}):A?(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Failed to load entity detail: ",A]})}):n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"dbvc-entity-toolbar",children:[(0,t.jsxs)("div",{className:"dbvc-entity-toolbar__meta",children:[(0,t.jsx)("div",{className:"dbvc-entity-toolbar__title",id:ie,children:he?(0,t.jsx)("a",{href:he,target:"_blank",rel:"noreferrer",children:ps}):ps}),(0,t.jsxs)("div",{className:"dbvc-entity-toolbar__sub",children:[(0,t.jsxs)("span",{children:[be," ",he&&"—"!==os?(0,t.jsx)("a",{href:he,target:"_blank",rel:"noreferrer",children:os}):os]}),"term"===fe&&(0,t.jsxs)("span",{children:["Taxonomy: ",ge||"—"]}),"term"===fe&&(0,t.jsxs)("span",{children:["Parent: ",us||"—"]}),(0,t.jsxs)("span",{children:["File: ",re?.path||"—"]})]})]}),I&&(0,t.jsx)("button",{type:"button",className:"dbvc-entity-detail__close",onClick:I,"aria-label":"Close entity detail",ref:I?ae:void 0,children:"Close"}),(0,t.jsxs)("div",{className:"dbvc-diff-filter",children:[(0,t.jsx)("span",{children:"View:"}),(0,t.jsx)("button",{type:"button",className:Me?"is-active":"",onClick:()=>E&&E("conflicts"),children:"Conflicts & Resolver"}),(0,t.jsx)("button",{type:"button",className:"full"===R?"is-active":"",onClick:()=>E&&E("full"),children:"Full Overview"}),(0,t.jsx)("button",{type:"button",className:"all"===R?"is-active":"",onClick:()=>E&&E("all"),children:"View All"})]}),(0,t.jsx)("p",{className:"dbvc-entity-toolbar__count",children:Me?`${Oe} field(s) awaiting review · ${Be} total`:"all"===R?`${Pe} meta field(s) shown.`:`${Pe} field(s) shown.`}),_e&&P&&(0,t.jsxs)("div",{className:"notice notice-warning",children:[(0,t.jsx)("p",{children:"This entity is missing its stored import hash. Sync it to prevent repeated reviews."}),(0,t.jsx)("button",{type:"button",className:"button button-secondary",onClick:()=>P(n?.vf_object_uid),disabled:U&&T===n?.vf_object_uid,children:U&&T===n?.vf_object_uid?"Storing hash…":"Store import hash"})]}),(()=>{const e=[];return ls.length>0&&(e.push({key:"accept_all",content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"button button-secondary",onClick:()=>{o&&window.confirm(`Accept ${ls.length} field(s)?`)&&o("accept",ls)},disabled:v,children:v?"Accepting…":"Accept All Visible"}),(0,t.jsx)("p",{className:"description",children:"Applies the bundle values to every field currently listed."})]})}),e.push({key:"keep_all",content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"button",onClick:()=>{o&&window.confirm(`Keep current values for ${ls.length} field(s)?`)&&o("keep",ls)},disabled:v,children:v?"Keeping…":"Keep All Visible"}),(0,t.jsx)("p",{className:"description",children:"Locks in the live values for each visible field without importing."})]})})),"function"==typeof d&&e.push({key:"snapshot",content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"button dbvc-button-inverted",onClick:d,disabled:O||!d,children:O?"Capturing snapshot…":"Capture current snapshot"}),(0,t.jsx)("p",{className:"description",children:`Refreshes the “current” baseline from the live ${"term"===fe?"term":"post"} before you compare.`})]})}),"function"==typeof c&&we>0&&e.push({key:"clear_decisions",content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"button",onClick:c,disabled:B,children:B?"Clearing…":"Clear all decisions"}),(0,t.jsx)("p",{className:"description",children:"Removes every Accept/Keep choice so you can re-evaluate this entity."})]})}),e.length?(0,t.jsx)("div",{className:"dbvc-entity-action-grid",children:e.map(e=>(0,t.jsx)("div",{className:"dbvc-entity-action",children:e.content},e.key))}):null})(),Ce.length>0&&(0,t.jsxs)("section",{className:"dbvc-entity-detail__masking",children:[(0,t.jsx)("h4",{children:"Masked fields"}),(0,t.jsx)("div",{className:"dbvc-mask-field-list",children:Ce.map((e,s)=>{const n=g[e.section]||e.section||"Meta",i=j[e.default_action]||"Masked field",a="dbvc-mask-field__status"+("ignore"===e.default_action?" is-pending":""),l=e.vf_object_uid||"mask";return(0,t.jsxs)("div",{className:"dbvc-mask-field",children:[(0,t.jsxs)("div",{className:"dbvc-mask-field__meta",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:r(e.label||e.meta_path||n)}),(0,t.jsxs)("div",{className:"dbvc-mask-field__label",children:[n,e.meta_path?(0,t.jsx)("code",{children:e.meta_path}):null]})]}),(0,t.jsx)("span",{className:a,children:i})]}),(0,t.jsxs)("div",{className:"dbvc-mask-field__values",children:[(0,t.jsxs)("span",{children:["Proposed: ",r(e.proposed_value)]}),null!=e.current_value?(0,t.jsxs)("span",{children:["Current: ",r(e.current_value)]}):null]})]},`${l}::${e.meta_path||s}`)})})]}),(0,t.jsxs)("p",{className:"dbvc-decision-summary",children:["Selections: ",ke]})]}),xe&&(0,t.jsxs)("div",{className:"dbvc-new-entity-card",children:[(0,t.jsxs)("div",{className:"dbvc-new-entity-card__header",children:[(0,t.jsx)("span",{className:"dbvc-badge dbvc-badge--new",children:"term"===k(re)?"New term":"New post"}),(0,t.jsx)("span",{className:"dbvc-new-entity-card__status",children:"accept_new"===je?"Accepted for import":"decline_new"===je?"Declined — will be skipped":"Pending reviewer decision"})]}),(0,t.jsxs)("p",{children:["This proposal would create a new ","term"===k(re)?N(re):re?.post_type||"post"," on this site. No UID, original ID, or slug match was detected locally, so choose whether to import it."]}),(0,t.jsxs)("div",{className:"dbvc-new-entity-actions",children:[(0,t.jsx)(s.Button,{variant:"accept_new"===je?"primary":"secondary",onClick:()=>r&&r(_,"accept_new"),disabled:ye,isBusy:ye&&"accept_new"===je,children:"Accept & import"}),(0,t.jsx)(s.Button,{variant:"decline_new"===je?"primary":"secondary",onClick:()=>r&&r(_,"decline_new"),disabled:ye,isBusy:ye&&"decline_new"===je,children:"term"===k(re)?"Decline new term":"Decline new post"}),(0,t.jsx)(s.Button,{variant:"tertiary",onClick:()=>r&&r(_,"clear"),disabled:ye||!je,children:"Clear choice"})]})]}),C&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsx)("p",{children:C})}),$e.length>0&&(0,t.jsxs)("div",{className:"dbvc-section-nav",children:[(0,t.jsx)("span",{children:Ue?"Sections:":"Jump to:"}),$e.map(e=>(0,t.jsx)("button",{type:"button",className:Ue||Fe!==e.key?"":"is-active",onClick:()=>{if(Ue){const s=document.getElementById(`dbvc-diff-${e.key}`);s&&s.scrollIntoView({behavior:"smooth",block:"start"})}else Le(e.key)},children:e.label},e.key)),(0,t.jsx)("button",{type:"button",className:Ue?"is-active":"",onClick:()=>Te(e=>!e),children:Ue?"Focus Section":"Show All"})]}),is.length>0?is.map(e=>(0,t.jsx)(H,{section:e,decisions:l,onDecisionChange:r,savingPaths:m},e.key)):(0,t.jsx)("p",{children:Me&&Be>0?"No resolver or media conflicts detected for this entity. Switch to Full Overview to inspect all differences.":"all"===R?"No meta fields found for this entity.":"No differences detected."}),Ae.length>0&&(0,t.jsxs)("div",{className:"dbvc-admin-app__resolver-attachments",children:[(0,t.jsx)("h4",{children:"Media Resolver"}),(0,t.jsx)("div",{className:"dbvc-panel-search",children:(0,t.jsxs)("label",{children:["Search:  ",(0,t.jsx)("input",{type:"search",value:Ie,onChange:e=>Re(e.target.value),placeholder:"Reason, asset UID, note…"})]})}),a&&(0,t.jsxs)("p",{className:"dbvc-resolver-summary",children:["Saved decisions — reuse: ",null!==(ee=a.reuse)&&void 0!==ee?ee:0,", map: ",null!==(se=a.map)&&void 0!==se?se:0,", download:"," ",null!==(te=a.download)&&void 0!==te?te:0,", skip: ",null!==(ne=a.skip)&&void 0!==ne?ne:0]}),y&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsx)("p",{children:y})}),Ee.length>0?(0,t.jsxs)("table",{className:"widefat",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Original ID"}),(0,t.jsx)("th",{children:"Target"}),(0,t.jsx)("th",{children:"Reason"}),(0,t.jsx)("th",{children:"Decision"}),(0,t.jsx)("th",{style:{width:"160px"},children:"Actions"})]})}),(0,t.jsx)("tbody",{children:Ee.map(e=>(0,t.jsx)(q,{attachment:e,saving:!!x[e.original_id],onSave:u,onClear:p,onApplyToSimilar:h},e.original_id))})]}):(0,t.jsx)("p",{children:"No resolver conflicts match your search."}),(0,t.jsxs)("div",{className:"dbvc-resolver-bulk",children:[(0,t.jsx)("h5",{children:"Bulk Apply Resolver Decision"}),(0,t.jsx)("p",{className:"description",children:"Match a subset of conflicts and apply a single decision without editing rows individually."}),(0,t.jsxs)("div",{className:"dbvc-resolver-bulk__filters",children:[(0,t.jsxs)("label",{children:["Match by",(0,t.jsxs)("select",{value:Ve,onChange:e=>ze(e.target.value),children:[(0,t.jsx)("option",{value:"reason",children:"Reason"}),(0,t.jsx)("option",{value:"asset_uid",children:"Asset UID"}),(0,t.jsx)("option",{value:"bundle_path",children:"Manifest Path"})]})]}),(0,t.jsxs)("label",{children:["Value",(0,t.jsxs)("select",{value:Ke,onChange:e=>He(e.target.value),disabled:0===(rs[Ve]||[]).length,children:[0===(rs[Ve]||[]).length&&(0,t.jsx)("option",{value:"",children:"No values detected"}),(rs[Ve]||[]).map(e=>(0,t.jsx)("option",{value:e,children:e||"— Not provided —"},e||"blank"))]})]}),(0,t.jsxs)("span",{className:"dbvc-resolver-bulk__count",children:["Matches: ",ms]})]}),(0,t.jsxs)("div",{className:"dbvc-resolver-controls dbvc-resolver-bulk__controls",children:[(0,t.jsxs)("select",{value:Je,onChange:e=>qe(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select action…"}),(0,t.jsx)("option",{value:"reuse",children:"Reuse existing"}),(0,t.jsx)("option",{value:"download",children:"Download new"}),(0,t.jsx)("option",{value:"map",children:"Map to attachment ID"}),(0,t.jsx)("option",{value:"skip",children:"Skip"})]}),vs&&(0,t.jsx)("input",{type:"number",min:"1",placeholder:"Attachment ID",value:We,onChange:e=>Ge(e.target.value)}),(0,t.jsx)("textarea",{value:Xe,onChange:e=>Ze(e.target.value),placeholder:"Optional note",rows:2}),(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:Qe,onChange:e=>Ye(e.target.checked)})," ","Remember as global rule"]})]}),ts&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsx)("p",{children:ts})}),(0,t.jsx)("button",{type:"button",className:"button button-secondary",onClick:async()=>{if(!Je)return void ns("Select an action to apply.");if(vs&&!We)return void ns("Enter a target attachment ID for this action.");if(!ms)return void ns("No matching conflicts were found for the selected filter.");if(!u)return;if(!window.confirm(`Apply this decision to ${ms} conflict(s) matched by ${"reason"===Ve?"reason":"asset_uid"===Ve?"asset UID":"manifest path"}?`))return;ss(!0),ns("");const e={action:Je,target_id:vs?Number(We):null,note:Xe,persist_global:Qe};try{for(const s of hs)s.original_id&&await u(s.original_id,e);Ze(""),Ge("")}catch(e){ns(e?.message||"Bulk apply failed.")}finally{ss(!1)}},disabled:es,children:es?"Applying…":"Apply to Matches"})]})]}),(0,t.jsxs)("div",{className:"dbvc-admin-app__entity-columns",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{children:"Raw Current"}),(0,t.jsx)("pre",{children:JSON.stringify(oe,null,2)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{children:"Raw Proposed (Bundle)"}),(0,t.jsx)("pre",{children:JSON.stringify(ce,null,2)})]})]})]}):(0,t.jsx)("p",{children:"Select an entity to view details."}))};function F({open:e,onClose:n,report:i,onMarkCanonical:a,actionKey:l,bulkMode:r,onBulkModeChange:o,confirmPhrase:c,confirmValue:d,onConfirmChange:u,onBulkCleanup:h,bulkBusy:m,bulkDisabled:v}){var b,f;return e?(0,t.jsxs)(s.Modal,{title:(0,t.jsxs)("span",{className:"dbvc-duplicates-modal__title",children:[`Duplicate entities (${null!==(b=i.count)&&void 0!==b?b:0})`,(0,t.jsx)("span",{className:"dbvc-duplicates-modal__lede",children:"Choose the filename format to keep and confirm the cleanup to delete the rest of the duplicate JSON files."})]}),onRequestClose:n,className:"dbvc-duplicates-modal",children:[(0,t.jsxs)("div",{className:"dbvc-duplicates-modal__bulk",children:[(0,t.jsxs)("label",{className:"dbvc-duplicates-modal__bulk-select",children:["Keep filenames as:",(0,t.jsx)("select",{value:r,onChange:e=>o&&o(e.target.value),children:[{value:"slug_id",label:"Slug + ID"},{value:"slug",label:"Slug"},{value:"id",label:"ID"}].map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"dbvc-duplicates-modal__bulk-inline",children:[(0,t.jsx)("input",{type:"text",value:d,placeholder:`Type ${c}`,onChange:e=>u&&u(e.target.value)}),(0,t.jsx)(s.Button,{variant:"primary",onClick:h,disabled:v,isBusy:m,children:m?"Cleaning…":"Bulk clean duplicates"})]})]}),0===(null!==(f=i.items)&&void 0!==f?f:[]).length?(0,t.jsx)("p",{children:"No duplicate manifest entries were detected for this proposal."}):i.items.map(e=>{var n,i;const r=null!==(n=e.entries)&&void 0!==n?n:[],o=r.reduce((e,s)=>{const t=s.post_modified?Date.parse(s.post_modified.replace(" ","T")):0;return Number.isFinite(t)&&t>e?t:e},0);return(0,t.jsxs)("div",{className:"dbvc-duplicate-group",children:[(0,t.jsxs)("div",{className:"dbvc-duplicate-group__header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:D(e)}),(0,t.jsxs)("div",{className:"dbvc-duplicate-group__meta",children:[(0,t.jsxs)("span",{children:["UID: ",e.vf_object_uid]}),(0,t.jsxs)("span",{children:["Slug: ",S(e)]}),(0,t.jsxs)("span",{children:["Type: ",N(e)]})]})]}),(0,t.jsx)("div",{className:"dbvc-duplicate-group__badges",children:(0,t.jsxs)("span",{className:"dbvc-badge",children:[null!==(i=e.entries?.length)&&void 0!==i?i:0," files"]})})]}),(0,t.jsxs)("table",{className:"widefat",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Path"}),(0,t.jsx)("th",{children:"Hash"}),(0,t.jsx)("th",{children:"Content hash"}),(0,t.jsx)("th",{children:"Modified"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Size"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:r.map((n,i)=>{const r=`${e.vf_object_uid}::${i}::${n.path||"no-path"}`,c=n.post_modified?Date.parse(n.post_modified.replace(" ","T")):0,d=o&&Number.isFinite(c)&&c===o;return(0,t.jsxs)("tr",{className:d?"is-latest":"",children:[(0,t.jsx)("td",{className:"dbvc-text-break",children:n.path||"—"}),(0,t.jsx)("td",{className:"dbvc-text-break",children:n.hash||"—"}),(0,t.jsx)("td",{className:"dbvc-text-break",children:n.content_hash||"—"}),(0,t.jsx)("td",{children:n.post_modified?p(n.post_modified):"—"}),(0,t.jsx)("td",{children:n.post_status||"—"}),(0,t.jsx)("td",{children:"number"==typeof n.size?`${n.size} B`:"—"}),(0,t.jsx)("td",{children:(0,t.jsx)(s.Button,{variant:"secondary",onClick:()=>a&&a(e.vf_object_uid,n.path),disabled:l===r,children:l===r?"Marking…":"Keep this file"})})]},r)})})]})]},e.vf_object_uid)}),(0,t.jsx)("p",{className:"description",children:"Tip: Clean up duplicate JSON files in the sync folder before exporting new proposals to keep reviewers focused on a single entity."})]}):null}const L=()=>{var r,c,d,u,h,m,v,b,f,g,j,y,k,I,L,V,z,K,H,J,q,G,X,Z,Q,Y,ee;const[se,te]=(0,e.useState)([]),[ne,ie]=(0,e.useState)(null),[ae,le]=(0,e.useState)(null),[re,oe]=(0,e.useState)(null),[ce,de]=(0,e.useState)([]),[ue,pe]=(0,e.useState)("needs_review"),[he,me]=(0,e.useState)(""),[ve,be]=(0,e.useState)(null),[fe,ge]=(0,e.useState)(null),[_e,xe]=(0,e.useState)(!1),[je,ye]=(0,e.useState)({}),[we,ke]=(0,e.useState)({}),[Ne,Ce]=(0,e.useState)(null),[Se,De]=(0,e.useState)(!0),[$e,Ae]=(0,e.useState)(!1),[Ie,Re]=(0,e.useState)(!1),[Ee,Me]=(0,e.useState)(!1),[Be,Oe]=(0,e.useState)(!1),[Pe,Ue]=(0,e.useState)(null),[Te,Fe]=(0,e.useState)(null),[Le,Ve]=(0,e.useState)(null),[ze,Ke]=(0,e.useState)(null),[He,Je]=(0,e.useState)(!1),[qe,We]=(0,e.useState)(!1),[Ge,Xe]=(0,e.useState)(!1),[Ze,Qe]=(0,e.useState)(""),[Ye,es]=(0,e.useState)(null),[ss,ts]=(0,e.useState)(null),[ns,is]=(0,e.useState)(!1),[as,ls]=(0,e.useState)("full"),[rs,os]=(0,e.useState)(!1),[cs,ds]=(0,e.useState)("conflicts"),[us,ps]=(0,e.useState)([]),[hs,ms]=(0,e.useState)(!1),[vs,bs]=(0,e.useState)([]),[fs,gs]=(0,e.useState)([]),[_s,xs]=(0,e.useState)({}),[js,ys]=(0,e.useState)(null),[ws,ks]=(0,e.useState)(!1),[Ns,Cs]=(0,e.useState)(!1),[Ss,Ds]=(0,e.useState)(!1),[$s,As]=(0,e.useState)(!1),[Is,Rs]=(0,e.useState)(()=>{const e={};return M.forEach(s=>{e[s.id]=!1!==s.defaultVisible}),e}),[Es,Ms]=(0,e.useState)({count:0,items:[]}),[Bs,Os]=(0,e.useState)(!1),[Ps,Us]=(0,e.useState)(null),[Ts,Fs]=(0,e.useState)(!1),[Ls,Vs]=(0,e.useState)(""),[zs,Ks]=(0,e.useState)("slug_id"),[Hs,Js]=(0,e.useState)(""),[qs,Ws]=(0,e.useState)(!1),[Gs,Xs]=(0,e.useState)(!1),[Zs,Qs]=(0,e.useState)(!1),[Ys,et]=(0,e.useState)(!1),[st,tt]=(0,e.useState)(!1),[nt,it]=(0,e.useState)(()=>new Set),[at,lt]=(0,e.useState)(!1),[rt,ot]=(0,e.useState)([]),[ct,dt]=(0,e.useState)(!1),[ut,pt]=(0,e.useState)(null),[ht,mt]=(0,e.useState)(!1),[vt,bt]=(0,e.useState)(!1),[ft,gt]=(0,e.useState)("ignore"),[_t,xt]=(0,e.useState)(""),[jt,yt]=(0,e.useState)(""),[wt,kt]=(0,e.useState)(!1),[Nt,Ct]=(0,e.useState)(!1),[St,Dt]=(0,e.useState)([]),[$t,At]=(0,e.useState)(!1),It=(0,e.useRef)(null),Rt=(0,e.useRef)(null),Et=(0,e.useRef)(null),Mt="DELETE",Bt=(0,e.useMemo)(()=>M.filter(e=>Is[e.id]),[Is]),Ot=(0,e.useCallback)(e=>{Rs(s=>{const t=M.find(s=>s.id===e);return t&&t.lockVisible?s:{...s,[e]:!s[e]}})},[]),Pt=(0,e.useCallback)(async(e,s={})=>{if(!e)return Ms({count:0,items:[]}),void Us(null);const{signal:t}=s;Os(!0),Us(null);try{var n,a;const s=await i(`proposals/${encodeURIComponent(e)}/duplicates`,t?{signal:t}:void 0);Ms({count:null!==(n=s.count)&&void 0!==n?n:s.items?s.items.length:0,items:null!==(a=s.items)&&void 0!==a?a:[]})}catch(e){if("AbortError"===e.name)return;Us(e?.message||"Failed to load duplicates."),Ms({count:0,items:[]})}finally{Os(!1)}},[]),Ut=(0,e.useRef)(null);(0,e.useEffect)(()=>{Ut.current=ve},[ve]);const Tt=(0,e.useCallback)(async(e,s,t)=>{if(!e)return de([]),[];Re(!0),Fe(null);try{var n;const a=s&&!["needs_review","needs_review_media","resolved","new_entities"].includes(s)||!s||"all"===s?"":`?status=${encodeURIComponent(s)}`,l=await i(`proposals/${encodeURIComponent(e)}/entities${a}`,{signal:t}),r=null!==(n=l.items)&&void 0!==n?n:[],o=E(r);return de(o),l.decision_summary&&te(s=>s.map(s=>s.id===e?{...s,decisions:l.decision_summary}:s)),l.resolver_decisions&&te(s=>s.map(s=>s.id===e?{...s,resolver_decisions:l.resolver_decisions}:s)),o}catch(e){return"AbortError"!==e.name&&Fe(e.message),[]}finally{Re(!1)}},[]),Ft="DBVC_MASK_UNDO",Lt=(0,e.useCallback)(async(e,s)=>{if(!e)return ps([]),[];ms(!0);try{var t;const n=null!==(t=(await i(`proposals/${encodeURIComponent(e)}/entities`,s?{signal:s}:void 0)).items)&&void 0!==t?t:[],a=E(n);return ps(a),a}catch(e){return"AbortError"!==e.name&&ps([]),[]}finally{ms(!1)}},[]),Vt=(0,e.useRef)({}),zt=(0,e.useCallback)(e=>Vt.current[e],[]),Kt=(0,e.useCallback)((e,s)=>{e&&(Vt.current[e]=s)},[]),Ht=(0,e.useCallback)(e=>`DBVC_MASK_CACHE_${e}`,[]),Jt=(0,e.useCallback)(e=>{if(!e||"undefined"==typeof window||!window.sessionStorage)return null;const s=window.sessionStorage.getItem(Ht(e));if(!s)return null;try{const e=JSON.parse(s);return e&&Array.isArray(e.fields)?e.updatedAt&&Date.now()-e.updatedAt>3e5?null:e:null}catch(e){return null}},[Ht]),qt=(0,e.useCallback)((e,s)=>{if(e&&"undefined"!=typeof window&&window.sessionStorage)try{window.sessionStorage.setItem(Ht(e),JSON.stringify({fields:s,updatedAt:Date.now()}))}catch(e){}},[Ht]),[Wt,Gt]=(0,e.useState)(0),Xt=(0,e.useCallback)(async(e,s)=>{if(!e)return ot([]),Gt(0),void bt(!1);dt(!0),pt(null),Gt(0);const t=e=>{if(e)return"object"==typeof e&&"signal"in e?e:{signal:e}};Kt(e,"loading");try{let n=1,a=[],l=!0,r=1,o=1;for(;l;){const c=await i(`proposals/${encodeURIComponent(e)}/masking?page=${n}`,t(s));Array.isArray(c?.fields)&&(a=a.concat(c.fields));const d=c?.chunk?.total_pages?parseInt(c.chunk.total_pages,10):1;o=d>0?d:1,r=n,c?.chunk?.has_more?n++:l=!1,Gt(Math.min(100,Math.round(r/o*100)))}ot(a),bt(!at&&a.length>0),Gt(100),qt(e,a),Kt(e,"success")}catch(s){if("AbortError"===s.name)return void Kt(e,"failed");console.error("DBVC masking fetch failed:",s),pt(s?.message||"Failed to load masking candidates."),Kt(e,"failed")}finally{dt(!1),setTimeout(()=>Gt(0),1500)}},[at,qt,Kt]);(0,e.useEffect)(()=>{if(!ne)return ot([]),void Gt(0);const e=Jt(ne);e&&Array.isArray(e.fields)?(ot(e.fields),Gt(100),at||bt(e.fields.length>0),Vt.current[ne]=!0):(ot([]),Gt(0),Vt.current[ne]=!1)},[ne,Jt,at]);const[Zt,Qt]=(0,e.useState)(null),[Yt,en]=(0,e.useState)(0),[sn,tn]=(0,e.useState)(!1),nn=(0,e.useCallback)(async()=>{const e=Array.isArray(rt)?rt:[];if(!ne||!e.length)return pt("No masked fields are available to apply."),void bt(!1);if("override"===ft&&!_t.trim())return void pt("Provide an override value to continue.");const s=[];for(let t=0;t<e.length;t+=50){const n=e.slice(t,t+50).map(e=>{const s={vf_object_uid:e.vf_object_uid,meta_path:e.meta_path,action:ft};return"auto_accept"===ft&&(s.suppress=!0),"override"===ft&&(s.override_value=_t,jt&&(s.note=jt)),s});s.push(n)}mt(!0),en(0),pt(null);try{const t=[];for(let e=0;e<s.length;e++){const n=s[e],i=await a(`proposals/${encodeURIComponent(ne)}/masking/apply`,{items:n});t.push(i),en(Math.min(99,Math.round((e+1)/s.length*100)))}en(100);const n=[];t.forEach(e=>{Array.isArray(e?.entities)&&n.push(...e.entities)}),n.length&&de(e=>e.map(e=>{const s=n.find(s=>s.vf_object_uid===e.vf_object_uid);return s?{...e,diff_state:s.diff_state||e.diff_state,decision_summary:s.decision_summary||e.decision_summary,overall_status:s.overall_status||e.overall_status}:e})),ve&&n.forEach(e=>{e.vf_object_uid===ve&&ge(s=>s?{...s,diff_state:e.diff_state||s.diff_state,decision_summary:e.decision_summary||s.decision_summary,overall_status:e.overall_status||s.overall_status}:s)});try{const s={proposalId:ne,items:e};window.sessionStorage&&window.sessionStorage.setItem(Ft,JSON.stringify(s)),Qt(s)}catch(e){}await Promise.all([Xt(ne),Tt(ne,ue),Pt(ne)]),bt(!1),bs(s=>[...s,{id:`${Date.now()}-mask`,severity:"success",title:"Masking applied",message:`Updated ${e.length} field${1===e.length?"":"s"}.`,timestamp:(new Date).toISOString()}])}catch(e){pt(e?.message||"Failed to apply masking rules.")}finally{mt(!1),setTimeout(()=>en(0),1500)}},[ne,rt,ft,jt,_t]),an=(0,e.useCallback)(async()=>{if(!Zt||!ne)return;const e=Array.isArray(Zt.items)?Zt.items:[];if(e.length){mt(!0),pt(null);try{const s=e.map(e=>({vf_object_uid:e.vf_object_uid,meta_path:e.meta_path,action:"ignore"}));await a(`proposals/${encodeURIComponent(ne)}/masking/apply`,{items:s}),window.sessionStorage&&window.sessionStorage.removeItem(Ft),Qt(null),await Promise.all([Xt(ne),Tt(ne,ue),Pt(ne)])}catch(e){pt(e?.message||"Failed to undo masking rules.")}finally{mt(!1)}}},[Zt,ne]),ln=(0,e.useCallback)(async()=>{if(ne){tn(!0),pt(null);try{const e=await a(`proposals/${encodeURIComponent(ne)}/masking/revert`,{});window.sessionStorage&&window.sessionStorage.removeItem(Ft),Qt(null),await Promise.all([Xt(ne),Tt(ne,ue),Pt(ne)]),bs(s=>[...s,{id:`${Date.now()}-mask-revert`,severity:"info",title:"Masking decisions reverted",message:(e?.cleared?.decisions||0)>0?`Cleared ${e.cleared.decisions} masked decision${1===e.cleared.decisions?"":"s"}.`:"No masked decisions matched the current masking rules.",timestamp:(new Date).toISOString()}])}catch(e){pt(e?.message||"Failed to revert masking decisions.")}finally{tn(!1)}}},[ne,Xt,Tt,ue,Pt]),rn=(0,e.useCallback)(async(e={})=>{const{signal:s,focusProposalId:t}=e;De(!0),Ue(null);try{var n;const e=null!==(n=(await i("proposals",s?{signal:s}:void 0)).items)&&void 0!==n?n:[];te(e),ie(s=>{var n;return t&&e.some(e=>e.id===t)?t:s&&e.some(e=>e.id===s)?s:null!==(n=e[0]?.id)&&void 0!==n?n:null})}catch(e){if("AbortError"===e.name)return;Ue(e.message)}finally{De(!1),Ae(!0)}},[]),on=(0,e.useCallback)(async e=>{if(!e)return;const s=se.find(s=>s.id===e);if(s)if(e!==ne){if(s.locked)bs(e=>[...e,{id:`${Date.now()}-proposal-delete-locked`,severity:"warning",title:"Proposal is locked",message:"Locked proposals cannot be deleted.",timestamp:(new Date).toISOString()}]);else if(window.confirm(`Delete proposal "${e}"? This cannot be undone.`)){le(e);try{await l(`proposals/${encodeURIComponent(e)}`),await rn({focusProposalId:ne&&ne!==e?ne:null}),bs(s=>[...s,{id:`${Date.now()}-proposal-delete-success`,severity:"info",title:"Proposal deleted",message:`Deleted ${e}.`,timestamp:(new Date).toISOString()}])}catch(s){bs(e=>[...e,{id:`${Date.now()}-proposal-delete-error`,severity:"error",title:"Delete failed",message:s?.message||"Unable to delete proposal.",timestamp:(new Date).toISOString()}])}finally{le(null)}}}else bs(e=>[...e,{id:`${Date.now()}-proposal-delete-blocked`,severity:"warning",title:"Cannot delete current proposal",message:"Select another proposal before deleting this one.",timestamp:(new Date).toISOString()}])},[se,ne,rn,bs]),cn=(0,e.useCallback)(()=>{ne&&Tt(ne,ue)},[ne,ue,Tt]),dn=(0,e.useCallback)(e=>{e.stopPropagation()},[]),un=(0,e.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),pn=(0,e.useMemo)(()=>fe?.resolver?.attachments?.length?fe.resolver.attachments:re?.attachments||[],[re,fe]),hn=((0,e.useCallback)(()=>{ne&&Pt(ne)},[ne,Pt]),(0,e.useCallback)(async(e,s)=>{if(ne&&e&&s){Vs(`${e}::${s}`),Us(null);try{await a(`proposals/${encodeURIComponent(ne)}/duplicates/cleanup`,{vf_object_uid:e,keep_path:s}),await Pt(ne),await Tt(ne,ue)}catch(e){Us(e?.message||"Failed to mark canonical entry.")}finally{Vs("")}}},[ne,Pt,Tt,ue])),mn=(0,e.useCallback)(async()=>{if(ne&&Es.count&&zs){Ws(!0),Us(null);try{await a(`proposals/${encodeURIComponent(ne)}/duplicates/cleanup`,{apply_all:!0,preferred_format:zs,confirm_token:Hs.trim()}),Js(""),await Pt(ne),await Tt(ne,ue)}catch(e){Us(e?.message||"Failed to clean duplicates.")}finally{Ws(!1)}}},[ne,Es.count,zs,Hs,Pt,Tt,ue]),vn=!Es.count||Bs||!zs||Hs.trim().toUpperCase()!==Mt||qs,[bn,fn]=(0,e.useState)(!1),gn=(0,e.useCallback)(e=>{it(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},[]),xn=(0,e.useCallback)((e,s)=>{it(t=>{const n=new Set(t);return e.forEach(e=>{s?n.add(e):n.delete(e)}),n})},[]),jn=(0,e.useCallback)(()=>{it(new Set)},[]),yn=(0,e.useCallback)(()=>{it(new Set(ce.map(e=>e.vf_object_uid)))},[ce]),wn=(0,e.useMemo)(()=>ce.filter(e=>w(e)),[ce]),kn=wn.length>0,Nn=(0,e.useCallback)(async()=>{if(ne&&kn){Xs(!0),Us(null);try{await a(`proposals/${encodeURIComponent(ne)}/entities/accept`,{scope:"new_only"}),await Tt(ne,ue),await Pt(ne)}catch(e){Us(e?.message||"Failed to accept new entities.")}finally{Xs(!1)}}},[ne,kn,Tt,ue,Pt]),Cn=(0,e.useCallback)(async()=>{if(ne&&0!==nt.size){Qs(!0),Ce(null);try{await a(`proposals/${encodeURIComponent(ne)}/entities/accept`,{scope:"selected",vf_object_uids:Array.from(nt)}),await Tt(ne,ue),jn()}catch(e){Ce(e?.message||"Failed to accept selected entities.")}finally{Qs(!1)}}},[ne,nt,Tt,ue,jn]),Sn=(0,e.useCallback)(async()=>{if(ne&&0!==nt.size){et(!0),Ce(null);try{await a(`proposals/${encodeURIComponent(ne)}/entities/unaccept`,{scope:"selected",vf_object_uids:Array.from(nt)}),await Tt(ne,ue),jn()}catch(e){Ce(e?.message||"Failed to unaccept selected entities.")}finally{et(!1)}}},[ne,nt,Tt,ue,jn]),Dn=(0,e.useCallback)(async()=>{if(ne&&0!==nt.size){tt(!0),Ce(null);try{await a(`proposals/${encodeURIComponent(ne)}/entities/unkeep`,{scope:"selected",vf_object_uids:Array.from(nt)}),await Tt(ne,ue),jn()}catch(e){Ce(e?.message||"Failed to unkeep selected entities.")}finally{tt(!1)}}},[ne,nt,Tt,ue,jn]);(0,e.useEffect)(()=>{es(null),ts(null),Je(!1),is(!1),ls("full"),os(!1),bs([])},[ne]),(0,e.useEffect)(()=>{"partial"!==as&&os(!1)},[as]),(0,e.useEffect)(()=>{if(0===vs.length)return;const e=setTimeout(()=>{bs(e=>e.slice(1))},6e3);return()=>clearTimeout(e)},[vs]),(0,e.useEffect)(()=>{const e=new AbortController;return rn({signal:e.signal}),()=>e.abort()},[rn]),(0,e.useEffect)(()=>{if("undefined"==typeof window||!window.sessionStorage)return;const e=window.sessionStorage.getItem(Ft);if(e)try{const s=JSON.parse(e);s?.proposalId===ne?Qt(s):(window.sessionStorage.removeItem(Ft),Qt(null))}catch(e){window.sessionStorage.removeItem(Ft),Qt(null)}else Qt(null)},[ne]),(0,e.useEffect)(()=>{if(!wt)return;const e=e=>{It.current&&It.current.contains(e.target)||kt(!1)},s=e=>{"Escape"===e.key&&kt(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keyup",s)}},[wt]),(0,e.useEffect)(()=>{if(!at)return;const e=e=>{Et.current&&Et.current.contains(e.target)||lt(!1)},s=e=>{"Escape"===e.key&&lt(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keyup",s)}},[at]);const $n=(0,e.useCallback)(async(e,s)=>{if(e){Me(!0),Ve(null);try{const t=await i(`proposals/${encodeURIComponent(e)}/resolver`,{signal:s});oe(t)}catch(e){"AbortError"!==e.name&&Ve(e.message)}finally{Me(!1)}}else oe(null)},[]);(0,e.useEffect)(()=>{if(!ne)return be(null),ge(null),void xe(!1);const e=new AbortController;return Tt(ne,ue,e.signal).then(e=>{if(!e.length)return be(null),void xe(!1);const s=Ut.current;s&&e.some(e=>e.vf_object_uid===s)||(be(null),xe(!1))}),()=>e.abort()},[ne,ue,Tt]),(0,e.useEffect)(()=>{if(!ne)return;const e=new AbortController;return $n(ne,e.signal),()=>e.abort()},[ne,$n]),(0,e.useEffect)(()=>{if(!ne)return Ms({count:0,items:[]}),void Us(null);const e=new AbortController;return Pt(ne,{signal:e.signal}),()=>e.abort()},[ne,Pt]),(0,e.useEffect)(()=>{if(!ne||!ve)return ge(null),ye({}),void ke({});const e=new AbortController;return(async()=>{Oe(!0),Ke(null),Ce(null),ke({});try{var s;const t=await i(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}`,{signal:e.signal});ge(t),ye(null!==(s=t.decisions)&&void 0!==s?s:{})}catch(e){"AbortError"!==e.name&&Ke(e.message)}finally{Oe(!1)}})(),()=>e.abort()},[ne,ve]),(0,e.useEffect)(()=>{if(!ne||at||ct||Ie)return;if(Array.isArray(rt)&&rt.length)return;if(void 0!==zt(ne))return;const e=new AbortController;return Xt(ne,{signal:e.signal}),()=>e.abort()},[ne,at,ct,rt,Ie,Xt,zt]),(0,e.useEffect)(()=>{if(!ne||!at)return;const e=new AbortController;return Xt(ne,{signal:e.signal}),()=>e.abort()},[ne,at,Xt]),(0,e.useEffect)(()=>{at||bt(rt.length>0)},[rt,at]);const An=(0,e.useCallback)((e,s)=>{const t=Number(e),n=(e=[])=>e.map(e=>{if((void 0!==e.original_id?e.original_id:e.descriptor?.original_id)===t){if(s)return{...e,decision:s};const{decision:t,...n}=e;return n}return e});oe(e=>e?{...e,attachments:n(e.attachments||[])}:e),ge(e=>e?{...e,resolver:{...e.resolver||{},attachments:n(e.resolver?.attachments||[])}}:e),de(e=>e.map(e=>e.vf_object_uid===ve?{...e,resolver:{...e.resolver||{},attachments:n(e.resolver?.attachments||[])}}:e))},[ve]),In=(0,e.useMemo)(()=>{const e=new Set;return ce.forEach(s=>{const t=A(s);t&&e.add(t)}),Array.from(e).sort((e,s)=>R($(e),$(s)))},[ce]),Rn=(0,e.useMemo)(()=>new Set(St),[St]),En=St.length+($t?1:0),Mn=(0,e.useCallback)(e=>{Dt(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},[]),Bn=(0,e.useCallback)(()=>{Dt([]),At(!1)},[]),On=(0,e.useMemo)(()=>{let e=ce;if("with_decisions"===ue&&(e=e.filter(e=>{var s;return(null!==(s=e.decision_summary?.total)&&void 0!==s?s:0)>0})),"uid_mismatch"===ue&&(e=e.filter(e=>!!e.uid_mismatch)),he){const s=he.toLowerCase();e=e.filter(e=>[D(e),S(e),N(e),C(e),e.path,e.term_taxonomy,e.taxonomy].filter(Boolean).join(" ").toLowerCase().includes(s))}return Rn.size>0&&(e=e.filter(e=>Rn.has(A(e)))),$t&&(e=e.filter(e=>!!e.uid_mismatch)),e},[ce,he,ue,Rn,$t]),Pn=(0,e.useMemo)(()=>ce.find(e=>e.vf_object_uid===ve),[ce,ve]);(0,e.useEffect)(()=>{it(e=>{const s=new Set,t=new Set(ce.map(e=>e.vf_object_uid));return e.forEach(e=>{t.has(e)&&s.add(e)}),s})},[ce]);const Un=(0,e.useMemo)(()=>ce.filter(e=>"missing_local_hash"===e.diff_state?.reason),[ce]),Tn=(0,e.useMemo)(()=>se.find(e=>e.id===ne),[se,ne]),Fn=(0,e.useMemo)(()=>{const e={proposed:{total:0,posts:0,terms:0},current:{total:0,posts:0,terms:0}};return us.forEach(s=>{const t="term"===s.entity_type||"string"==typeof s.post_type&&s.post_type.startsWith("term:")||s.term_taxonomy||s.taxonomy?"terms":"posts";e.proposed.total++,e.proposed[t]+=1,!s.is_new_entity&&s.identity_match&&"none"!==s.identity_match&&(e.current.total++,e.current[t]+=1)}),e},[us]),Ln=null!==(r=Tn?.media_items)&&void 0!==r?r:null!==(c=re?.metrics?.detected)&&void 0!==c?c:0,Vn=null!==(d=re?.metrics?.reused)&&void 0!==d?d:0,zn=On.length,Kn=Array.isArray(rt)?rt.length:0,Hn=(0,e.useMemo)(()=>{if(!Array.isArray(rt))return 0;const e=new Set;return rt.forEach(s=>{s?.vf_object_uid&&e.add(s.vf_object_uid)}),e.size},[rt]),Jn=(0,e.useMemo)(()=>Array.isArray(rt)?rt.reduce((e,s)=>{const t=s?.vf_object_uid;return t?(e[t]||(e[t]=[]),e[t].push(s),e):e},{}):{},[rt]),qn=(0,e.useMemo)(()=>{const e={needs_review:0,needs_review_media:0,new_entities:0,with_decisions:0,uid_mismatch:0};return ce.forEach(s=>{"needs_review"===s.overall_status&&e.needs_review++,s.media_needs_review&&e.needs_review_media++,s.is_new_entity&&e.new_entities++;const t=s.decision_summary||{};(null!=t.total?t.total:0)>0&&e.with_decisions++,s.uid_mismatch&&e.uid_mismatch++}),[{id:"needs_review",label:"Needs Review",count:e.needs_review,filter:"needs_review"},{id:"needs_review_media",label:"Unresolved meta",count:e.needs_review_media,filter:"needs_review_media"},{id:"new_entities",label:"New entities",count:e.new_entities,filter:"new_entities"},{id:"with_decisions",label:"Pending decisions",count:e.with_decisions,filter:"with_decisions"},{id:"uid_mismatch",label:"UID mismatch",count:e.uid_mismatch,filter:"uid_mismatch"}]},[ce]),Wn=(0,e.useMemo)(()=>[{label:"Keep & ignore current meta (uses mask config)",value:"ignore"},{label:"Auto-accept new meta & suppress future reviews",value:"auto_accept"},{label:"Override masked value",value:"override"}],[]),Gn=(0,e.useMemo)(()=>({apply:`Apply the configured masking rules to every entity in this proposal. Learn more: ${o("live-proposal-masking")}`,ignore:`Ignore this masked field so it no longer counts toward Needs Review. Learn more: ${o("ignore-masked-field")}`,auto:`Auto-accept the masked value and suppress it from future diffs. Learn more: ${o("auto-accept-and-suppress")}`,override:`Override the masked value with a sanitized replacement. Learn more: ${o("override-masked-value")}`,revert:`Clear masking decisions that were applied via this tool using the current masking rules. Learn more: ${o("revert-masked-decisions")}`}),[]);(0,e.useEffect)(()=>{if(!On.length)return be(null),void xe(!1);ve&&!On.some(e=>e.vf_object_uid===ve)&&(be(null),xe(!1))},[On,ve]),(0,e.useEffect)(()=>{ds("conflicts")},[ve]),(0,e.useEffect)(()=>{if(!ne)return ps([]);const e=new AbortController;return Lt(ne,e.signal),()=>{e.abort()}},[ne,Lt]);const Xn=(0,e.useCallback)(e=>{if(!e)return be(null),void xe(!1);be(s=>s===e?s:e),xe(!0)},[]),Zn=(0,e.useCallback)(async e=>{if(ne){We(!0);try{const s=await a(`proposals/${encodeURIComponent(ne)}/status`,{status:e});te(e=>e.map(e=>e.id===ne?{...e,status:s.status}:e))}catch(e){ts(e?.message||"Failed to update proposal status.")}finally{We(!1)}}},[ne]),Qn=(0,e.useCallback)(async()=>{if(ne&&0!==Un.length&&window.confirm(`Store import hashes for ${Un.length} entit${1===Un.length?"y":"ies"}?`)){Qe("bulk"),Xe(!0),Ce(null);try{await a(`proposals/${encodeURIComponent(ne)}/entities/hash-sync`,{vf_object_uids:Un.map(e=>e.vf_object_uid)}),await Tt(ne,ue)}catch(e){Ce(e?.message||"Failed to store import hashes.")}finally{Xe(!1),Qe("")}}},[ne,Un,Tt,ue]),Yn=(0,e.useCallback)(async e=>{if(ne&&e){Qe(e),Xe(!0),Ce(null);try{var s;await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(e)}/hash-sync`,{}),await Tt(ne,ue);const t=await i(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(e)}`);ge(t),ye(null!==(s=t.decisions)&&void 0!==s?s:{})}catch(e){Ce(e?.message||"Failed to store import hash.")}finally{Xe(!1),Qe("")}}},[ne,ue,Tt]),ei=(0,e.useCallback)(()=>{xe(!1)},[]),si=(0,e.useCallback)(()=>{ne&&(ts(null),es(null),ls("full"),os(!1),is(!0))},[ne]),ti=(0,e.useCallback)(()=>{He||is(!1)},[He]),ni=(0,e.useCallback)(e=>{bs(s=>s.filter(s=>s.id!==e))},[]),ii=(0,e.useCallback)(async()=>{if(ne){is(!1),ts(null),es(null),Je(!0);try{var e,s;const r=await a(`proposals/${encodeURIComponent(ne)}/apply`,{mode:as,ignore_missing_hash:rs});es(r),r.decisions&&te(e=>e.map(e=>e.id===ne?{...e,decisions:r.decisions}:e)),r.resolver_decisions&&te(e=>e.map(e=>e.id===ne?{...e,resolver_decisions:r.resolver_decisions}:e)),r.status&&te(e=>e.map(e=>e.id===ne?{...e,status:r.status}:e));const o=null!==(e=r?.result?.imported)&&void 0!==e?e:0,c=null!==(s=r?.result?.skipped)&&void 0!==s?s:0,d=Array.isArray(r?.result?.errors)?r.result.errors:[],u=(new Date).toISOString(),p=Date.now(),h=[];var t,n,i,l;d.length>0&&h.push(d[0]),r.decisions_cleared&&r.auto_clear_enabled&&h.push("Reviewer decisions cleared."),r.ignore_missing_hash&&h.push("Hash check override enabled."),r.resolver_decisions&&h.push(`Resolver decisions — reuse: ${null!==(t=r.resolver_decisions.reuse)&&void 0!==t?t:0}, map: ${null!==(n=r.resolver_decisions.map)&&void 0!==n?n:0}, download: ${null!==(i=r.resolver_decisions.download)&&void 0!==i?i:0}, skip: ${null!==(l=r.resolver_decisions.skip)&&void 0!==l?l:0}`),"closed"===r.status&&h.push("Proposal marked closed."),bs(e=>[...e,{id:p,severity:d.length?"warning":"success",title:`Applied ${Tn?.title||ne}`,message:`Imported ${o} · Skipped ${c}`,detail:h.join(" "),timestamp:u}]),gs(e=>{var s,t;return[{id:p,timestamp:u,proposalId:ne,proposalTitle:Tn?.title||ne,mode:null!==(s=r.mode)&&void 0!==s?s:as,imported:o,skipped:c,errors:d,decisionsCleared:Boolean(r.decisions_cleared&&r.auto_clear_enabled),ignoreMissingHash:Boolean(r.ignore_missing_hash),resolverDecisions:null!==(t=r.resolver_decisions)&&void 0!==t?t:null},...e].slice(0,10)}),be(null),xe(!1),ge(null),ye({}),ke({});const m=await Tt(ne,ue);m.length&&(be(m[0].vf_object_uid),xe(!0)),await $n(ne)}catch(e){const s=e?.message||"Apply request failed.";ts(s);const t=(new Date).toISOString(),n=Date.now(),i=[s];rs&&i.push("Hash check override requested."),bs(e=>[...e,{id:n,severity:"warning",title:`Apply failed (${Tn?.title||ne})`,message:s,detail:i.join(" "),timestamp:t}]),gs(e=>[{id:n,timestamp:t,proposalId:ne,proposalTitle:Tn?.title||ne,mode:as,imported:0,skipped:0,errors:[s],decisionsCleared:!1,ignoreMissingHash:rs},...e].slice(0,10))}finally{Je(!1)}}},[ne,as,Tt,ue,$n,Tn,rs]),ai=(0,e.useCallback)(async(e,s)=>{if(ne&&ve){Ce(null),ke(s=>({...s,[e]:!0}));try{var t,n;const i=await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}/selections`,{path:e,action:s}),l=null!==(t=i.decisions)&&void 0!==t?t:{},r=null!==(n=i.summary)&&void 0!==n?n:null;ye(l),ge(e=>{var s;return e?{...e,decisions:l,decision_summary:null!=r?r:e.decision_summary,new_entity_decision:null!==(s=l[_])&&void 0!==s?s:e.new_entity_decision}:e}),de(e=>e.map(e=>{var s;return e.vf_object_uid===ve?{...e,decision_summary:null!=r?r:e.decision_summary,new_entity_decision:null!==(s=l[_])&&void 0!==s?s:e.new_entity_decision}:e})),i.proposal_summary&&te(e=>e.map(e=>e.id===ne?{...e,decisions:i.proposal_summary}:e))}catch(e){Ce(e.message)}finally{ke(s=>{const t={...s};return delete t[e],t})}}},[ne,ve]),li=(0,e.useCallback)(async(e,s)=>{if(ne){ys(null),xs(s=>({...s,[e]:!0}));try{var t;const n=await a(`proposals/${encodeURIComponent(ne)}/resolver/${encodeURIComponent(e)}`,s);return An(e,null!==(t=n.decision)&&void 0!==t?t:null),n}catch(e){throw ys(e.message),e}finally{xs(s=>{const t={...s};return delete t[e],t})}}},[ne,An]),ri=(0,e.useCallback)(async(e,s)=>{await li(e,s)},[li]),oi=(0,e.useCallback)(async(e,s="proposal")=>{if(ne){ys(null),xs(s=>({...s,[e]:!0}));try{var t;const n=await l(`proposals/${encodeURIComponent(ne)}/resolver/${encodeURIComponent(e)}?scope=${encodeURIComponent(s)}`);An(e,null!==(t=n.decision)&&void 0!==t?t:null)}catch(e){ys(e.message)}finally{xs(s=>{const t={...s};return delete t[e],t})}}},[ne,An]),ci=(0,e.useCallback)(async(e,s)=>{const t=e.reason||"";if(!t||!pn.length)return;const n=pn.filter(s=>s.original_id!==e.original_id&&(s.reason||"")===t);if(n.length){if(window.confirm(`Apply this ${s.action} decision to ${n.length} other conflict(s) with reason "${t}"?`))try{await Promise.all(n.map(e=>li(e.original_id,s)))}catch(e){}}else window.alert("No similar conflicts found to apply this decision to.")},[pn,li]),di=(0,e.useCallback)(async()=>{if(ne&&ve&&window.confirm("Clear all Accept/Keep choices for this entity?")){Ce(null),ks(!0),ke({});try{var e,s;const t=await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}/selections`,{action:"clear_all"}),n=null!==(e=t.decisions)&&void 0!==e?e:{},i=null!==(s=t.summary)&&void 0!==s?s:null;ye(n),ge(e=>e?{...e,decisions:n,decision_summary:null!=i?i:e.decision_summary}:e),de(e=>e.map(e=>e.vf_object_uid===ve?{...e,decision_summary:null!=i?i:e.decision_summary}:e)),t.proposal_summary&&te(e=>e.map(e=>e.id===ne?{...e,decisions:t.proposal_summary}:e))}catch(e){Ce(e.message)}finally{ks(!1)}}},[ne,ve]),ui=(0,e.useCallback)(async()=>{if(ne&&ve){Cs(!0),Ce(null);try{var e,s;const t=null!==(e=(await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}/snapshot`,{})).snapshot)&&void 0!==e?e:null;t&&ge(e=>e?{...e,current:t,current_source:"snapshot"}:e);const n=await i(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}`);ge(n),ye(null!==(s=n.decisions)&&void 0!==s?s:{}),de(e=>e.map(e=>{var s;return e.vf_object_uid===ve?{...e,decision_summary:null!==(s=n.decision_summary)&&void 0!==s?s:e.decision_summary}:e}))}catch(e){Ce(e.message)}finally{Cs(!1)}}},[ne,ve]),pi=(0,e.useCallback)(async()=>{if(ne){Ds(!0),Ce(null);try{var e,s;const n=await i(`proposals/${encodeURIComponent(ne)}/entities?status=needs_review`),l=Array.isArray(n.items)?n.items:[],r=l.map(e=>e.vf_object_uid).filter(e=>"string"==typeof e&&e.length>0),o=r.length?{entity_ids:r}:{},c=await a(`proposals/${encodeURIComponent(ne)}/snapshot`,o),d=null!==(e=c.captured)&&void 0!==e?e:0,u=null!==(s=c.targets)&&void 0!==s?s:r.length||l.length||0,p=(new Date).toISOString();if(bs(e=>[...e,{id:Date.now(),severity:"info",title:"Snapshots captured",message:`Captured ${d}/${u||d} snapshot(s) for proposal ${ne}.`,timestamp:p}]),await Tt(ne,ue),await $n(ne),ve){var t;const e=await i(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}`);ge(e),ye(null!==(t=e.decisions)&&void 0!==t?t:{})}}catch(e){Ce(e.message)}finally{Ds(!1)}}},[ne,ve,ue,Tt,$n]),hi=(0,e.useCallback)(async()=>{if(window.confirm("This will delete all stored backups, snapshots, and reviewer decisions. Continue?")){As(!0),Ce(null);try{await l("maintenance/clear-proposals"),await rn(),ie(null),de([]),ge(null),oe(null),ye({}),ke({}),bs(e=>[...e,{id:Date.now(),severity:"info",title:"Backups cleared",message:"All proposal backups, snapshots, and decisions have been removed.",timestamp:(new Date).toISOString()}])}catch(e){Ce(e.message)}finally{As(!1)}}},[rn]),mi=(0,e.useCallback)(async(e,s)=>{if(!ne||!ve||!Array.isArray(s)||0===s.length)return;const t=s.filter(e=>"string"==typeof e&&e.length>0);if(!t.length)return;const n=e=>{var s,t;const n=null!==(s=e.decisions)&&void 0!==s?s:{},i=null!==(t=e.summary)&&void 0!==t?t:null;ye(n),ge(e=>e?{...e,decisions:n,decision_summary:null!=i?i:e.decision_summary}:e),de(e=>e.map(e=>e.vf_object_uid===ve?{...e,decision_summary:null!=i?i:e.decision_summary}:e)),e.proposal_summary&&te(s=>s.map(s=>s.id===ne?{...s,decisions:e.proposal_summary}:s))};Ce(null),fn(!0),ke(e=>{const s={...e};return t.forEach(e=>{s[e]=!0}),s});try{try{const s=await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}/selections/bulk`,{action:e,paths:t});n(s),ke({})}catch(s){if(404!==s.status)throw s;await(async()=>{for(const s of t){const t=await a(`proposals/${encodeURIComponent(ne)}/entities/${encodeURIComponent(ve)}/selections`,{path:s,action:e});n(t),ke(e=>{const t={...e};return delete t[s],t})}})()}}catch(e){Ce(e.message)}finally{fn(!1),ke({})}},[ne,ve]),vi=null!==(r=Tn?.decisions)&&void 0!==r?r:null,bi=null!==(c=vi?.total)&&void 0!==c?c:0,fi=null!==(d=vi?.accepted)&&void 0!==d?d:0,gi=null!==(u=vi?.kept)&&void 0!==u?u:0,_i=null!==(h=vi?.accepted_new)&&void 0!==h?h:0,xi=null!==(m=vi?.entities_reviewed)&&void 0!==m?m:0,ji=null!==(v=Tn?.resolver_decisions)&&void 0!==v?v:null,yi=null!==(b=ji?.reuse)&&void 0!==b?b:0,wi=null!==(f=ji?.map)&&void 0!==f?f:0,ki=null!==(g=ji?.download)&&void 0!==g?g:0,Ni=null!==(j=ji?.skip)&&void 0!==j?j:0,Ci=null!==(y=null!==(k=re?.metrics?.unresolved)&&void 0!==k?k:Tn?.resolver?.metrics?.unresolved)&&void 0!==y?y:0,Si=Array.isArray(Ye?.result?.errors)?Ye.result.errors:[],Di=Si.length?"notice notice-warning":"notice notice-success",$i=null!==(I=Ye?.result?.imported)&&void 0!==I?I:0,Ai=null!==(L=Ye?.result?.skipped)&&void 0!==L?L:0,Ii=null!==(V=Ye?.result?.media_resolver?.metrics)&&void 0!==V?V:{},Ri=null!==(z=Ii?.unresolved)&&void 0!==z?z:0,Ei=null!==(K=Ye?.result?.media_reconcile)&&void 0!==K?K:null,Mi=(0,e.useCallback)(e=>{rn({focusProposalId:e});const s=(new Date).toISOString(),t=Date.now();bs(n=>[...n,{id:t,severity:"success",title:"Proposal uploaded",message:`Bundle registered as ${e}`,timestamp:s}])},[rn]),Bi=(0,e.useCallback)(e=>{const s=(new Date).toISOString(),t=Date.now();bs(n=>[...n,{id:t,severity:"error",title:"Upload failed",message:e,timestamp:s}])},[]);if(!$e&&Se){const e=s?.Spinner?(0,t.jsx)(s.Spinner,{}):(0,t.jsx)("span",{style:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",background:"var(--dbvc-color-surface-muted, #f6f7f7)",fontSize:20},children:"…"});return(0,t.jsx)("div",{className:"dbvc-admin-app dbvc-admin-app--initializing",children:(0,t.jsxs)("div",{className:"dbvc-admin-app__loading-panel",style:{minHeight:280,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,textAlign:"center",padding:"32px 16px"},children:[e,(0,t.jsx)("p",{style:{fontSize:18,margin:0},children:"Preparing proposals… please keep this tab open."}),(0,t.jsx)("small",{style:{color:"var(--dbvc-color-text-subtle, #8c8f94)",maxWidth:420,lineHeight:1.6},children:"We’re refreshing proposal data and synchronizing reviewer decisions. This can take a moment after updates."})]})})}return!$e&&Pe?(0,t.jsxs)("p",{className:"dbvc-admin-app-error",children:["Error loading proposals: ",r(Pe)]}):(0,t.jsxs)("div",{className:"dbvc-admin-app",onClick:dn,onMouseDown:dn,onSubmit:un,children:[vs.length>0&&(0,t.jsx)("div",{className:"dbvc-toasts",children:vs.map(e=>(0,t.jsxs)("div",{className:`dbvc-toast dbvc-toast--${e.severity}`,children:[(0,t.jsxs)("div",{className:"dbvc-toast__content",children:[(0,t.jsx)("strong",{children:r(e.title)}),(0,t.jsx)("span",{children:r(e.message)}),e.detail&&(0,t.jsx)("small",{children:r(e.detail)}),(0,t.jsx)("small",{className:"dbvc-toast__time",children:p(e.timestamp)})]}),(0,t.jsx)("button",{type:"button",className:"dbvc-toast__dismiss",onClick:()=>ni(e.id),"aria-label":"Dismiss notification",children:"×"})]},e.id))}),(0,t.jsxs)("div",{className:"dbvc-admin-app__header",children:[(0,t.jsx)("h1",{children:"DBVC Proposals"}),(0,t.jsx)(s.Button,{variant:"secondary",onClick:()=>rn(),disabled:Se&&$e,children:Se&&$e?"Refreshing…":"Refresh list"}),(0,t.jsx)(s.Button,{variant:"tertiary",onClick:hi,disabled:$s,isBusy:$s,children:$s?"Clearing…":"Clear all backups"})]}),(0,t.jsx)(O,{onUploaded:Mi,onError:Bi}),Pe&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Failed to load proposals: ",r(Pe)]})}),(0,t.jsx)(B,{proposals:se,selectedId:ne,onSelect:ie,onDelete:on,deleteBusyId:ae}),Tn&&(0,t.jsxs)("section",{className:"dbvc-admin-app__detail",children:[(0,t.jsx)("h2",{children:Tn.title}),(0,t.jsxs)("p",{className:"dbvc-admin-app__detail-meta",children:["Generated: ",p(Tn.generated_at)," · Files:"," ",null!==(H=Tn.files)&&void 0!==H?H:"—"," · Media: ",null!==(J=Tn.media_items)&&void 0!==J?J:"—"," · Status:"," ",(0,t.jsx)("strong",{children:"closed"===Tn.status?"Closed":"Open"})," ",(0,t.jsx)("span",{className:"dbvc-badge dbvc-badge--resolver",children:(0,t.jsx)("a",{href:"#dbvc-global-resolver",children:"Global rules enabled"})})]}),Le&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Resolver error: ",Le]})}),Ee?(0,t.jsx)("p",{children:"Loading resolver metrics…"}):(0,t.jsx)(P,{resolver:re}),(0,t.jsxs)("div",{className:"dbvc-admin-app__actions",children:[(0,t.jsx)("button",{type:"button",className:"button button-primary",onClick:si,disabled:He||"closed"===Tn.status,title:"closed"===Tn.status?"Reopen this proposal before applying new changes.":void 0,children:He?"Applying…":"Close & Apply Proposal"}),"closed"===Tn.status?(0,t.jsxs)("div",{className:"dbvc-admin-app__status-note",children:[(0,t.jsx)("p",{children:"This proposal has been closed. Reopen it to continue reviewing this snapshot."}),(0,t.jsx)("button",{type:"button",className:"button",onClick:()=>Zn("draft"),disabled:qe,children:qe?"Reopening…":"Reopen proposal"})]}):(0,t.jsx)("p",{className:"description",children:"Applying will close this proposal snapshot. Re-export on the source site for additional changes."}),bi>0&&(0,t.jsxs)("div",{className:"dbvc-decisions",children:[(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--accept",children:[fi," accept"]}),_i>0&&(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--new",children:[_i," new"]}),(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--keep",children:[gi," keep"]}),(0,t.jsxs)("span",{className:"dbvc-badge dbvc-badge--reviewed",children:[xi," reviewed"]})]})]}),ss&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Apply failed: ",r(ss)]})}),Ye&&(0,t.jsxs)("div",{className:Di,children:[(0,t.jsxs)("p",{children:['Applied proposal "',Tn?.title||ne,'". Mode: ',null!==(q=Ye.mode)&&void 0!==q?q:"full"," · Imported ",$i," · Skipped"," ",Ai,Ye.decisions_cleared&&Ye.auto_clear_enabled?" · Reviewer decisions were cleared.":"",Ri>0&&` · ${Ri} resolver conflict(s) remain.`]}),Ei&&(0,t.jsxs)("p",{className:"dbvc-resolver-summary",children:["Media reconciliation — created: ",null!==(G=Ei.created)&&void 0!==G?G:0,", unresolved: ",null!==(X=Ei.unresolved)&&void 0!==X?X:0]}),Ye.resolver_decisions&&(0,t.jsxs)("p",{className:"dbvc-resolver-summary",children:["Resolver decisions applied — reuse: ",null!==(Z=Ye.resolver_decisions.reuse)&&void 0!==Z?Z:0,", map:"," ",null!==(Q=Ye.resolver_decisions.map)&&void 0!==Q?Q:0,", download: ",null!==(Y=Ye.resolver_decisions.download)&&void 0!==Y?Y:0,", skip:"," ",null!==(ee=Ye.resolver_decisions.skip)&&void 0!==ee?ee:0]}),Si.length>0&&(0,t.jsx)("ul",{children:Si.map((e,s)=>(0,t.jsx)("li",{children:r(e)},s))})]}),ji&&(0,t.jsx)("div",{className:"dbvc-resolver-summary",children:(0,t.jsxs)("span",{children:["Resolver decisions — reuse: ",yi,", map: ",wi,", download:"," ",ki,", skip: ",Ni]})}),fs.length>0&&(0,t.jsxs)("div",{className:"dbvc-apply-history",children:[(0,t.jsx)("h3",{children:"Recent Apply Runs"}),(0,t.jsx)("ul",{children:fs.map(e=>{var s,n,i,a;return(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:p(e.timestamp)})," — Mode ",e.mode," · Imported ",e.imported," · Skipped ",e.skipped,e.errors.length?` · ${e.errors.length} error(s)`:"",e.decisionsCleared?" · Selections cleared":"",e.ignoreMissingHash?" · Hash override":"",e.resolverDecisions?` · Resolver decisions (reuse ${null!==(s=e.resolverDecisions.reuse)&&void 0!==s?s:0}, map ${null!==(n=e.resolverDecisions.map)&&void 0!==n?n:0}, download ${null!==(i=e.resolverDecisions.download)&&void 0!==i?i:0}, skip ${null!==(a=e.resolverDecisions.skip)&&void 0!==a?a:0})`:""]},e.id)})})]}),ns&&(0,t.jsxs)(s.Modal,{title:`Apply proposal "${Tn?.title||ne}"`,onRequestClose:ti,isDismissible:!He,shouldCloseOnClickOutside:!He,children:[(0,t.jsxs)("div",{className:"dbvc-apply-modal__summary",children:[(0,t.jsx)("p",{children:"This will run the import pipeline for the selected proposal using the chosen mode."}),(0,t.jsx)("p",{className:"dbvc-apply-modal__warning",children:"Applying closes this proposal snapshot. To continue reviewing additional entities, export a new proposal after this step or reopen if necessary."}),bi>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Reviewer selections captured:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[fi," field(s) marked Accept"]}),_i>0&&(0,t.jsxs)("li",{children:[_i," new entity approval(s)"]}),(0,t.jsxs)("li",{children:[gi," field(s) kept as-is"]}),(0,t.jsxs)("li",{children:[xi," entity row(s) touched"]})]}),(0,t.jsx)("p",{className:"description",children:"Only fields marked Accept will overwrite live data. Other fields remain unchanged."})]}):(0,t.jsx)("p",{className:"dbvc-apply-modal__warning",children:"No reviewer selections have been recorded. Applying now only imports entities with Accept/Keep selections or new entities you marked “Accept & import.” All other entities are skipped."})]}),(0,t.jsx)(s.RadioControl,{label:"Import mode",selected:as,options:[{label:"Full import (copy entire proposal)",value:"full"},{label:"Partial import (skip unchanged items when hashes match)",value:"partial"}],onChange:e=>ls(e)}),(0,t.jsxs)("div",{className:"dbvc-apply-mode-help",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Full import (recommended):"})," Applies only the fields you accepted, records the close-out, and leaves untouched entities for the next export."]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Partial import (legacy):"})," Only needed for old proposals missing import hashes. Behavior otherwise matches full import."]})]}),"partial"===as&&(0,t.jsx)(s.CheckboxControl,{label:"Ignore missing import hash validation",checked:rs,onChange:e=>os(e),help:"Use only for legacy backups that predate import hash support. Recommended to resolve hash mismatches when possible."}),(0,t.jsx)("p",{className:"description",children:"Selections will be cleared automatically after a successful apply if the auto-clear setting is enabled in Configure → Import."}),(0,t.jsxs)("div",{className:"dbvc-apply-modal__footer",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:ti,disabled:He,children:"Cancel"}),(0,t.jsx)(s.Button,{variant:"primary",onClick:ii,isBusy:He,disabled:He,children:"Close & Apply Proposal"})]})]}),(0,t.jsxs)("div",{className:"dbvc-entities-header",children:[(0,t.jsx)("h3",{children:"Entities"}),Bs&&(0,t.jsx)("span",{className:"dbvc-duplicates-loading",children:"Checking duplicates…"})]}),(0,t.jsxs)("div",{className:"dbvc-entity-summary",children:[(0,t.jsxs)("div",{className:"dbvc-entity-summary__block",children:[(0,t.jsx)("strong",{children:"Total Proposed Entities"}),(0,t.jsxs)("div",{className:"dbvc-entity-summary__counts",children:[(0,t.jsxs)("span",{children:["Total: ",Fn.proposed.total]}),(0,t.jsxs)("span",{children:["Posts: ",Fn.proposed.posts]}),(0,t.jsxs)("span",{children:["Terms: ",Fn.proposed.terms]}),(0,t.jsxs)("span",{children:["Media: ",Ln]})]})]}),(0,t.jsxs)("div",{className:"dbvc-entity-summary__block",children:[(0,t.jsx)("strong",{children:"Total Current Entities"}),(0,t.jsxs)("div",{className:"dbvc-entity-summary__counts",children:[(0,t.jsxs)("span",{children:["Total: ",Fn.current.total]}),(0,t.jsxs)("span",{children:["Posts: ",Fn.current.posts]}),(0,t.jsxs)("span",{children:["Terms: ",Fn.current.terms]}),(0,t.jsxs)("span",{children:["Media: ",Vn]})]})]}),(0,t.jsxs)("div",{className:"dbvc-entity-summary__block",children:[(0,t.jsx)("strong",{children:"Filtered Results"}),(0,t.jsxs)("div",{className:"dbvc-entity-summary__counts",children:[(0,t.jsxs)("span",{children:["Showing: ",zn]}),hs&&(0,t.jsx)("span",{children:"Updating totals…"})]})]})]}),Ps&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Failed to load duplicate summary: ",Ps]})}),(0,t.jsxs)("div",{className:"dbvc-admin-app__filters",children:[(0,t.jsxs)("label",{children:["Show: ",(0,t.jsxs)("select",{value:ue,onChange:e=>{pe(e.target.value)},children:[(0,t.jsx)("option",{value:"all",children:x.all}),(0,t.jsx)("option",{value:"needs_review",children:x.needs_review}),(0,t.jsx)("option",{value:"needs_review_media",children:x.needs_review_media}),(0,t.jsx)("option",{value:"resolved",children:x.resolved}),(0,t.jsx)("option",{value:"new_entities",children:x.new_entities}),(0,t.jsx)("option",{value:"with_decisions",children:x.with_decisions}),(0,t.jsx)("option",{value:"uid_mismatch",children:x.uid_mismatch})]})]}),(0,t.jsxs)("label",{children:[" Search: ",(0,t.jsx)("input",{type:"search",value:he,onChange:e=>{me(e.target.value)},placeholder:"Title, type, path…"})]})]}),(0,t.jsxs)("div",{className:"dbvc-entity-badges-row",children:[(0,t.jsx)("div",{className:"dbvc-entity-status-badges",children:qn.map(e=>(0,t.jsxs)("button",{type:"button",className:"dbvc-status-badge"+(ue===e.filter?" is-active":""),disabled:0===e.count,"aria-pressed":ue===e.filter,onClick:()=>pe(ue===e.filter?"all":e.filter),children:[(0,t.jsx)("span",{children:e.label}),(0,t.jsx)("strong",{children:e.count})]},e.id))})]}),(0,t.jsx)("div",{className:"dbvc-entity-tools-row",children:[nt.size>0||ce.length>nt.size?(0,t.jsxs)("div",{className:"dbvc-selection-controls",children:[ce.length>nt.size?(0,t.jsxs)(s.Button,{variant:"secondary",className:"dbvc-selection-controls__button",onClick:yn,disabled:0===ce.length,children:[(0,t.jsx)("span",{className:"dashicons dashicons-yes","aria-hidden":"true"}),(0,t.jsxs)("span",{children:["Select all (",ce.length,")"]})]}):null,nt.size>0?(0,t.jsxs)(s.Button,{variant:"secondary",className:"dbvc-selection-controls__button",onClick:jn,children:[(0,t.jsx)("span",{className:"dashicons dashicons-dismiss","aria-hidden":"true"}),(0,t.jsxs)("span",{children:["Clear selection (",nt.size,")"]})]}):null]}):null,(0,t.jsx)("div",{className:"dbvc-filter-toggle"+(Nt?" is-open":""),ref:Rt,onMouseLeave:()=>Ct(!1),children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n,{content:"Filter entities by type or UID mismatch.",children:(0,t.jsxs)(s.Button,{variant:"secondary",className:"dbvc-filter-toggle__button",onClick:()=>Ct(e=>!e),"aria-haspopup":"true","aria-expanded":Nt,"aria-controls":"dbvc-filter-toggle-menu",children:[(0,t.jsx)("span",{className:"dashicons dashicons-filter","aria-hidden":"true"}),(0,t.jsx)("span",{className:"dbvc-filter-toggle__button-label",children:"Filters"}),En>0&&(0,t.jsx)("span",{className:"dbvc-filter-toggle__count",children:En}),(0,t.jsx)("span",{className:"screen-reader-text",children:"Toggle filter menu"})]})}),Nt&&(0,t.jsxs)("div",{id:"dbvc-filter-toggle-menu",className:"dbvc-filter-toggle__menu",role:"menu",children:[(0,t.jsxs)("div",{className:"dbvc-filter-toggle__group",children:[(0,t.jsx)("strong",{children:"Object type"}),In.length?(0,t.jsx)("div",{className:"dbvc-filter-toggle__options",children:In.map(e=>(0,t.jsxs)("label",{className:"dbvc-filter-toggle__option",children:[(0,t.jsx)("input",{type:"checkbox",checked:St.includes(e),onChange:()=>Mn(e)}),(0,t.jsx)("span",{children:e})]},e))}):(0,t.jsx)("span",{className:"dbvc-filter-toggle__empty",children:"No object types available."})]}),(0,t.jsxs)("div",{className:"dbvc-filter-toggle__group",children:[(0,t.jsx)("strong",{children:"vf_object_uid"}),(0,t.jsxs)("label",{className:"dbvc-filter-toggle__option",children:[(0,t.jsx)("input",{type:"checkbox",checked:$t,onChange:e=>At(e.target.checked)}),(0,t.jsx)("span",{children:"Mismatch only"})]})]}),(0,t.jsx)("div",{className:"dbvc-filter-toggle__actions",children:(0,t.jsx)(s.Button,{variant:"secondary",onClick:Bn,disabled:0===En,children:"Clear filters"})})]})]})}),(0,t.jsx)("div",{className:"dbvc-column-toggle"+(wt?" is-open":""),ref:It,onMouseEnter:()=>kt(!0),onMouseLeave:()=>kt(!1),children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n,{content:"Choose which columns are visible in the All Entities table.",children:(0,t.jsxs)(s.Button,{variant:"secondary",className:"dbvc-column-toggle__button",onClick:()=>kt(e=>!e),"aria-haspopup":"true","aria-expanded":wt,"aria-controls":"dbvc-column-toggle-menu",children:[(0,t.jsx)("span",{className:"dashicons dashicons-screenoptions","aria-hidden":"true"}),(0,t.jsx)("span",{className:"dbvc-column-toggle__button-label",children:"Columns"}),(0,t.jsx)("span",{className:"screen-reader-text",children:"Toggle column visibility menu"})]})}),wt&&(0,t.jsx)("div",{id:"dbvc-column-toggle-menu",className:"dbvc-column-toggle__menu",role:"menu",children:M.map(e=>(0,t.jsxs)("label",{className:"dbvc-column-toggle__option",children:[(0,t.jsx)("input",{type:"checkbox",checked:Is[e.id],onChange:()=>Ot(e.id),disabled:e.lockVisible}),(0,t.jsx)("span",{children:e.label})]},e.id))})]})}),Tn?(0,t.jsxs)("div",{className:`dbvc-actions-tray${at?" is-open":""}${vt?" has-attention":""}`,ref:Et,children:[(0,t.jsx)(n,{content:"Open Accept/Keep actions, snapshots, and masking tools.",children:(0,t.jsxs)(s.Button,{variant:"secondary",className:"dbvc-actions-tray__button",onClick:()=>lt(e=>{const s=!e;return s&&bt(!1),s}),"aria-expanded":at,"aria-haspopup":"true",children:[(0,t.jsx)("span",{className:"dashicons dashicons-admin-tools","aria-hidden":"true"}),(0,t.jsx)("span",{children:"Actions & tools"}),(0,t.jsx)("span",{className:"screen-reader-text",children:"Toggle bulk actions tray"})]})}),at&&(0,t.jsxs)("div",{className:"dbvc-actions-tray__panel",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__section",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__section-heading",children:[(0,t.jsx)("strong",{children:"Selected entities"}),(0,t.jsx)("p",{children:"Bulk Accept/Keep controls for the entities you checked in the table."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__items",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{className:"dbvc-new-entities-accept-button",variant:"primary",onClick:Cn,disabled:Zs||0===nt.size,isBusy:Zs,children:Zs?"Accepting selected…":nt.size>0?`Accept ${nt.size} selected`:"Accept selected"}),(0,t.jsx)("p",{children:nt.size>0?"Apply the proposal values to every selected entity.":"Select one or more entities to enable bulk Accept."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:Sn,disabled:Ys||0===nt.size,isBusy:Ys,children:Ys?"Unaccepting…":"Unaccept selected"}),(0,t.jsx)("p",{children:"Clear Accept decisions for every selected entity."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:Dn,disabled:st||0===nt.size,isBusy:st,children:st?"Unkeeping…":"Unkeep selected"}),(0,t.jsx)("p",{children:"Remove Keep decisions so fields return to Needs Review."})]})]})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__section",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__section-heading",children:[(0,t.jsx)("strong",{children:"New entities"}),(0,t.jsx)("p",{children:"Decide what to do with content that doesn’t exist locally yet."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__items",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{className:"dbvc-new-entities-accept-button",variant:"primary",onClick:Nn,disabled:Gs||!kn,isBusy:Gs,children:Gs?"Accepting…":`Accept all new entities (${wn.length})`}),(0,t.jsx)("p",{children:"Import every pending new post or term with one click."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{className:"dbvc-new-entities-button",variant:"secondary",onClick:()=>{pe("new_entities"),me("")},children:`Review ${wn.length} new ${1===wn.length?"entity":"entities"}`}),(0,t.jsx)("p",{children:"Open the New entities filter to inspect each diff."})]})]})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__section",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__section-heading",children:[(0,t.jsx)("strong",{children:"Snapshots & maintenance"}),(0,t.jsx)("p",{children:"Keep proposal data in sync before you apply decisions."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__items",children:[(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:cn,disabled:Ie,isBusy:Ie,children:Ie?"Refreshing…":"Refresh entities"}),(0,t.jsx)("p",{children:"Reload entity rows, selections, and resolver stats."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:pi,disabled:Ss,isBusy:Ss,children:Ss?"Capturing snapshots…":"Capture full snapshot"}),(0,t.jsx)("p",{children:Ci>0?`Capture JSON snapshots for ${Ci} unresolved entity ${1===Ci?"diff":"diffs"}.`:"Capture fresh JSON snapshots for every entity."})]}),Un.length>0&&(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:Qn,disabled:Ge&&"bulk"===Ze,isBusy:Ge&&"bulk"===Ze,children:Ge&&"bulk"===Ze?"Storing hashes…":`Store hashes (${Un.length})`}),(0,t.jsx)("p",{children:"Sync import hashes for entities missing their stored value."})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__item",children:[(0,t.jsx)(s.Button,{variant:"primary",className:"dbvc-duplicates-button",onClick:()=>Fs(!0),disabled:0===Es.count,children:Es.count>0?`Resolve ${Es.count} duplicate${1===Es.count?"":"s"}`:"No duplicates detected"}),(0,t.jsx)("p",{children:Es.count>0?"Launch the duplicate modal to pick a canonical entity before continuing.":"All manifest entries look unique."})]})]})]}),(0,t.jsxs)("div",{className:"dbvc-actions-tray__section dbvc-actions-tray__section--masking",children:[(0,t.jsxs)("div",{className:"dbvc-tools-panel__section dbvc-tools-panel__section--masking",children:[(0,t.jsxs)("div",{className:"dbvc-tools-panel__section-heading",children:[(0,t.jsx)("strong",{children:"Meta masking"}),(ct||ht)&&(0,t.jsxs)("span",{className:"dbvc-mask-progress",children:[ct?Wt:Yt,ct?"% loaded":"% applied"]}),(0,t.jsx)("a",{href:o("live-proposal-masking"),target:"_blank",rel:"noreferrer",children:"Masking guide ↗"}),Zt&&(0,t.jsx)(s.Button,{variant:"tertiary",onClick:an,disabled:ht,children:ht?"Reverting…":"Undo last masking"})]}),ut&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Masking error: ",ut]})}),ct?(0,t.jsx)("p",{children:"Loading masking rules…"}):Kn>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Found ",Kn," masked field",1===Kn?"":"s"," across ",Hn," entit",1===Hn?"y":"ies",". Choose how to handle them."]}),s?.SelectControl?(0,t.jsx)(s.SelectControl,{label:"Bulk action",value:ft,options:Wn,onChange:e=>gt(e)}):(0,t.jsxs)("label",{children:["Bulk action",(0,t.jsxs)("select",{value:ft,onChange:e=>gt(e.target.value),children:Wn.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),"override"===ft&&(0,t.jsxs)("div",{className:"dbvc-mask-field__override",children:[s?.TextareaControl?(0,t.jsx)(s.TextareaControl,{label:"Override value",value:_t,onChange:e=>xt(e),rows:3}):(0,t.jsxs)("label",{children:["Override value",(0,t.jsx)("textarea",{value:_t,onChange:e=>xt(e.target.value)})]}),s?.TextControl?(0,t.jsx)(s.TextControl,{label:"Note (optional)",value:jt,onChange:e=>yt(e)}):(0,t.jsxs)("label",{children:["Note (optional)",(0,t.jsx)("input",{type:"text",value:jt,onChange:e=>yt(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"dbvc-mask-actions",children:[(0,t.jsx)(n,{content:Gn.apply,children:(0,t.jsx)(s.Button,{variant:"primary",onClick:nn,disabled:ht||ct||!Kn,isBusy:ht,children:ht?"Applying…":"Apply masking rules"})}),(0,t.jsx)(n,{content:Gn.revert,children:(0,t.jsx)(s.Button,{variant:"secondary",onClick:ln,disabled:sn||ht||ct,isBusy:sn,children:sn?"Reverting…":"Revert masking decisions"})}),(0,t.jsx)(s.Button,{variant:"tertiary",onClick:()=>ne&&Xt(ne),disabled:ct,isBusy:ct,children:ct?"Refreshing…":"Refresh list"})]})]}):(0,t.jsxs)("p",{children:["No masked fields pending in this proposal. Learn more in the ",(0,t.jsx)("a",{href:o("live-proposal-masking"),target:"_blank",rel:"noreferrer",children:"masking reference"}),"."]})]})]})]})]}):null]}),Te&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsxs)("p",{children:["Failed to load entities: ",Te]})}),(0,t.jsxs)("div",{className:"dbvc-entity-table-wrapper",children:[Es.count>0&&(0,t.jsx)("button",{type:"button",className:"dbvc-duplicates-overlay",onClick:()=>Fs(!0),title:"Resolve duplicate manifest entries before continuing.",children:"Duplicate manifest entries detected — resolve these first"}),(0,t.jsx)(U,{entities:On,loading:Ie,selectedEntityId:ve,onSelect:Xn,columns:Bt,selectedIds:nt,onToggleSelection:gn,onToggleSelectionAll:xn})]}),(0,t.jsx)(W,{}),(0,t.jsx)(T,{entityDetail:fe,resolverInfo:Pn?.resolver,resolverDecisionSummary:Tn?.resolver_decisions,decisions:je,onDecisionChange:ai,onBulkDecision:mi,onResetDecisions:di,onCaptureSnapshot:ui,onResolverDecision:ri,onResolverDecisionReset:oi,onApplyResolverDecisionToSimilar:ci,savingPaths:we,bulkSaving:bn,resolverSaving:_s,resolverError:js,decisionError:Ne,loading:Be,error:ze,filterMode:cs,onFilterModeChange:ds,isOpen:_e,onClose:ei,resettingDecisions:ws,snapshotCapturing:Ns,onHashSync:Yn,hashSyncing:Ge,hashSyncTarget:Ze,maskFieldsByEntity:Jn}),(0,t.jsx)(F,{open:Ts,onClose:()=>Fs(!1),onMarkCanonical:hn,actionKey:Ls,report:Es,bulkMode:zs,onBulkModeChange:Ks,confirmPhrase:Mt,confirmValue:Hs,onConfirmChange:Js,onBulkCleanup:mn,bulkBusy:qs,bulkDisabled:vn})]})]})};class V extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){this.props.onError&&this.props.onError(e,s)}render(){return this.state.hasError?(0,t.jsxs)("div",{className:"dbvc-admin-app dbvc-admin-app--crashed",children:[(0,t.jsx)("h2",{children:"DBVC Proposals encountered an error"}),(0,t.jsxs)("div",{className:"notice notice-error",children:[(0,t.jsx)("p",{children:"The interface hit an unexpected error. You can reload this page to try again."}),(0,t.jsx)("p",{children:(0,t.jsx)("button",{type:"button",className:"button",onClick:()=>window.location.reload(),children:"Reload"})})]}),this.state.error&&(0,t.jsxs)("p",{className:"dbvc-admin-app__error-detail",children:["Error: ",h(this.state.error.message||this.state.error)]})]}):this.props.children}}const z=(e,s)=>{try{const t={message:e&&e.message?e.message:String(e),stack:e&&e.stack?e.stack:null,componentStack:s&&s.componentStack?s.componentStack:null,path:window.location&&window.location.href?window.location.href:null,context:"admin-app"};a("logs/client",t)}catch(e){}},K=()=>{const s=document.getElementById("dbvc-admin-app-root");if(!s)return;const n=e.createRoot?e.createRoot(s):null,i=(0,t.jsx)(V,{onError:z,children:(0,t.jsx)(L,{})});n?n.render(i):(0,e.render)(i,s)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",K):K();const H=({section:s,decisions:n,onDecisionChange:i,savingPaths:a})=>{const[l,r]=(0,e.useState)(!0);return(0,t.jsxs)("div",{className:"dbvc-admin-app__diff-section",id:`dbvc-diff-${s.key}`,children:[(0,t.jsxs)("button",{type:"button",className:"dbvc-admin-app__diff-toggle",onClick:()=>r(e=>!e),"aria-expanded":l,children:[(0,t.jsx)("h4",{children:s.label}),(0,t.jsx)("span",{children:l?"Collapse":"Expand"})]}),l?(0,t.jsxs)("table",{className:"widefat dbvc-admin-app__diff-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{style:{width:"25%"},children:"Field"}),(0,t.jsx)("th",{children:"Current"}),(0,t.jsx)("th",{children:"Proposed"}),(0,t.jsx)("th",{style:{width:"20%"},children:"Decision"})]})}),(0,t.jsx)("tbody",{children:s.items.map(e=>{var s;const l=((e,s)=>{const t=m(e),n=m(s);if(t===n)return null;if(t.length>5e3||n.length>5e3)return null;const i=Math.min(t.length,n.length);let a=0;for(;a<i&&t[a]===n[a];)a++;let l=t.length-1,r=n.length-1;for(;l>=a&&r>=a&&t[l]===n[r];)l--,r--;return{old:{before:t.slice(0,a),diff:t.slice(a,l+1),after:t.slice(l+1)},new:{before:n.slice(0,a),diff:n.slice(a,r+1),after:n.slice(r+1)}}})(e.from,e.to),r=null!==(s=n?.[e.path])&&void 0!==s?s:"",o=!!a[e.path],d=!!e.is_equal,p=["dbvc-diff-row"];return(c(e.from)||c(e.to))&&((e,s,t)=>{const n=`${e||"unknown"}::${s||"unknown"}`;u.has(n)||(u.add(n),console.warn("DBVC: Promise detected in entity drawer values.",{entity_uid:e,path:s,value:t}))})(n?.item?.vf_object_uid||n?.vf_object_uid||"",e.path,c(e.from)?e.from:e.to),d?p.push("is-equal"):"accept"===r?p.push("is-accepted"):"keep"===r?p.push("is-kept"):p.push("is-unreviewed"),(0,t.jsxs)("tr",{className:p.join(" "),children:[(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"dbvc-field-label",children:[h(e.label||e.path),e.path&&(0,t.jsx)("div",{className:"dbvc-field-label__key",children:h(e.path)})]})}),(0,t.jsx)("td",{children:l&&l.old.diff?v(l.old):h(e.from)}),(0,t.jsx)("td",{children:l&&l.new.diff?v(l.new):h(e.to)}),(0,t.jsxs)("td",{children:[d?(0,t.jsx)("em",{children:"No difference"}):(0,t.jsxs)("div",{className:"dbvc-decision-controls",children:[(0,t.jsxs)("div",{className:"dbvc-decision-options",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"radio",name:`decision-${e.path}`,value:"keep",checked:"keep"===r,disabled:o,onChange:()=>i&&i(e.path,"keep")}),"Keep"]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"radio",name:`decision-${e.path}`,value:"accept",checked:"accept"===r,disabled:o,onChange:()=>i&&i(e.path,"accept")}),"Accept"]})]}),(0,t.jsx)("button",{type:"button",className:"button-link dbvc-decision-clear",onClick:()=>i&&i(e.path,"clear"),disabled:o||!r,children:"Clear decision"})]}),!d&&(0,t.jsxs)("div",{className:"dbvc-decision-state",children:[(0,t.jsx)("span",{className:"dbvc-decision-status",children:"accept"===r?"Accepted":"keep"===r?"Kept":"Not reviewed"}),o&&(0,t.jsx)("span",{className:"saving",children:"Saving…"})]})]})]},e.path)})})]}):(0,t.jsxs)("div",{className:"dbvc-admin-app__no-diff",children:["Collapsed (",s.items.length," changes)."]})]})},J=({src:e,label:s})=>(0,t.jsxs)("div",{className:"dbvc-resolver-inline-preview",children:[e?(0,t.jsx)("img",{src:e,alt:"",className:"dbvc-resolver-inline-preview__image",loading:"lazy"}):(0,t.jsx)("span",{className:"dbvc-resolver-inline-preview__placeholder",children:"—"}),(0,t.jsx)("span",{className:"dbvc-resolver-inline-preview__label",children:null!=s?s:"—"})]}),q=({attachment:s,saving:n,onSave:i,onClear:a,onApplyToSimilar:l})=>{var r,o;const c=s.original_id,[d,u]=(0,e.useState)(s.decision?.action||""),[p,h]=(0,e.useState)(s.decision?.target_id?String(s.decision.target_id):""),[m,v]=(0,e.useState)(s.decision?.note||""),[b,f]=(0,e.useState)("global"===s.decision?.scope);(0,e.useEffect)(()=>{u(s.decision?.action||""),h(s.decision?.target_id?String(s.decision.target_id):""),v(s.decision?.note||""),f("global"===s.decision?.scope)},[s.decision]);const g="reuse"===d||"map"===d,_=parseInt(p,10),x=d&&(!g||_>0);return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:y(s.status||"unknown")}),(0,t.jsx)("td",{children:(0,t.jsx)(J,{src:s.preview?.proposed,label:c})}),(0,t.jsx)("td",{children:(0,t.jsx)(J,{src:s.preview?.local,label:null!==(r=s.target_id)&&void 0!==r?r:"—"})}),(0,t.jsx)("td",{children:null!==(o=s.reason)&&void 0!==o?o:"—"}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"dbvc-resolver-controls dbvc-resolver-controls--decision",children:[(0,t.jsxs)("div",{className:"dbvc-resolver-control",children:[(0,t.jsx)("span",{className:"dbvc-resolver-control__label",children:"Decision"}),(0,t.jsxs)("select",{value:d,onChange:e=>u(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select…"}),(0,t.jsx)("option",{value:"reuse",children:"Reuse existing"}),(0,t.jsx)("option",{value:"download",children:"Download new"}),(0,t.jsx)("option",{value:"map",children:"Map to attachment ID"}),(0,t.jsx)("option",{value:"skip",children:"Skip"})]})]}),g&&(0,t.jsxs)("div",{className:"dbvc-resolver-control",children:[(0,t.jsx)("span",{className:"dbvc-resolver-control__label",children:"Target attachment"}),(0,t.jsx)("input",{type:"number",min:"1",placeholder:"Attachment ID",value:p,onChange:e=>h(e.target.value)}),(0,t.jsx)("span",{className:"dbvc-field-hint",children:"Provide an attachment ID for reuse/map actions."})]}),(0,t.jsxs)("div",{className:"dbvc-resolver-control dbvc-resolver-control--note",children:[(0,t.jsx)("span",{className:"dbvc-resolver-control__label",children:"Reviewer note"}),(0,t.jsx)("textarea",{value:m,onChange:e=>v(e.target.value),placeholder:"Optional note",rows:2})]}),(0,t.jsxs)("label",{className:"dbvc-resolver-remember",children:[(0,t.jsxs)("span",{className:"dbvc-toggle",children:[(0,t.jsx)("input",{type:"checkbox",className:"dbvc-toggle__input",checked:b,onChange:e=>f(e.target.checked)}),(0,t.jsx)("span",{className:"dbvc-toggle__track","aria-hidden":"true"})]}),(0,t.jsx)("span",{className:"dbvc-toggle__label",children:"Remember for future proposals"})]})]})}),(0,t.jsxs)("td",{children:[(0,t.jsx)("button",{type:"button",className:"button button-primary",disabled:!x||n,onClick:()=>i&&i(c,{action:d,target_id:g?_:null,note:m,persist_global:b}),children:n?"Saving…":"Save"}),s.decision&&(0,t.jsx)("button",{type:"button",className:"button-link-delete",onClick:()=>a&&a(c,"global"===s.decision.scope?"global":"proposal"),disabled:n,children:"Clear"}),s.decision&&s.reason&&l&&(0,t.jsx)("button",{type:"button",className:"button-link",onClick:()=>{var e,t;return l(s,{action:s.decision?.action,target_id:null!==(e=s.decision?.target_id)&&void 0!==e?e:null,note:null!==(t=s.decision?.note)&&void 0!==t?t:"",persist_global:"global"===s.decision?.scope})},disabled:n,children:"Apply to similar"})]})]})},W=()=>{const[s,n]=(0,e.useState)([]),[r,o]=(0,e.useState)(!0),[c,d]=(0,e.useState)(null),[u,h]=(0,e.useState)(0),[m,v]=(0,e.useState)({}),[b,f]=(0,e.useState)(!1),[g,_]=(0,e.useState)(!1),[x,j]=(0,e.useState)(null),[y,w]=(0,e.useState)({original_id:"",action:"",target_id:"",note:""}),[k,N]=(0,e.useState)(""),[C,S]=(0,e.useState)(!1),[D,$]=(0,e.useState)(!0),[A,I]=(0,e.useState)(!1),[R,E]=(0,e.useState)({imported:0,errors:[]}),M=(0,e.useRef)(null),[B,O]=(0,e.useState)(""),P=(0,e.useRef)(""),U=(0,e.useMemo)(()=>{if(!B)return s;const e=B.toLowerCase();return s.filter(s=>[s.original_id,s.action,s.note,s.target_id,s.saved_at].filter(Boolean).map(e=>String(e).toLowerCase()).some(s=>s.includes(e)))},[B,s]),T=s.length>0,F=U.length>0,L=(Object.values(m).some(Boolean),!x&&y.original_id&&s.some(e=>String(e.original_id)===String(y.original_id))),V=("reuse"===y.action||"map"===y.action)&&y.target_id&&s.some(e=>String(e.original_id)!==String(y.original_id)&&e.target_id&&Number(e.target_id)===Number(y.target_id));(0,e.useEffect)(()=>{if(!P.current){const e=s.find(e=>e.target_id);e&&(P.current=String(e.target_id))}},[s]),(0,e.useEffect)(()=>{let e=!0;return(async()=>{o(!0),d(null);try{const t=await i("resolver-rules");var s;e&&n(null!==(s=t.rules)&&void 0!==s?s:[])}catch(s){e&&d(s.message)}finally{e&&o(!1)}})(),()=>{e=!1}},[u]);const z=(e=null)=>{var s,t,n;e?(j(e),w({original_id:String(null!==(s=e.original_id)&&void 0!==s?s:""),action:null!==(t=e.action)&&void 0!==t?t:"",target_id:e.target_id?String(e.target_id):"",note:null!==(n=e.note)&&void 0!==n?n:""})):(j(null),w({original_id:"",action:"",target_id:P.current||"",note:""})),N(""),_(!0)},K=()=>{_(!1),N(""),j(null)},H=(e,s)=>{w(t=>{const n={...t,[e]:s};return"action"===e&&("reuse"===s||"map"===s?!n.target_id&&P.current&&(n.target_id=P.current):n.target_id=""),n})};return(0,t.jsxs)("section",{className:"dbvc-resolver-rules",id:"dbvc-global-resolver",children:[(0,t.jsxs)("div",{className:"dbvc-resolver-rules__header",children:[(0,t.jsx)("h2",{children:"Global Resolver Rules"}),(0,t.jsx)("button",{type:"button",className:"button button-link",onClick:()=>$(e=>!e),children:D?"Show rules":"Hide rules"})]}),(0,t.jsx)("p",{className:"description",children:"Decisions saved with “remember for future proposals” appear here. They apply automatically whenever a matching original media ID is detected in any proposal."}),!D&&(0,t.jsxs)(t.Fragment,{children:[r&&(0,t.jsx)("p",{children:"Loading resolver rules…"}),c&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsx)("p",{children:c})}),!r&&!T&&(0,t.jsx)("p",{children:"No global rules saved yet."}),T&&(0,t.jsx)("div",{className:"dbvc-panel-search",children:(0,t.jsxs)("label",{children:["Search: ",(0,t.jsx)("input",{type:"search",value:B,onChange:e=>O(e.target.value),placeholder:"ID, action, note…"})]})}),!r&&T&&!F&&(0,t.jsxs)("p",{children:["No rules match “",B,"”."]}),!r&&F&&(0,t.jsxs)("table",{className:"widefat striped",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:(0,t.jsx)("input",{type:"checkbox",checked:b,onChange:()=>{const e=!b;if(f(e),e){const e={};s.forEach(s=>{e[s.original_id]=!0}),v(e)}else v({})}})}),(0,t.jsx)("th",{children:"Original ID"}),(0,t.jsx)("th",{children:"Action"}),(0,t.jsx)("th",{children:"Target"}),(0,t.jsx)("th",{children:"Note"}),(0,t.jsx)("th",{children:"Saved"}),(0,t.jsx)("th",{})]})}),(0,t.jsx)("tbody",{children:U.map(e=>{var s,n;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"checkbox",checked:!!m[e.original_id],onChange:()=>{return s=e.original_id,void v(e=>({...e,[s]:!e[s]}));var s}})}),(0,t.jsx)("td",{children:e.original_id}),(0,t.jsx)("td",{children:e.action}),(0,t.jsx)("td",{children:null!==(s=e.target_id)&&void 0!==s?s:"—"}),(0,t.jsx)("td",{children:null!==(n=e.note)&&void 0!==n?n:"—"}),(0,t.jsx)("td",{children:p(e.saved_at)}),(0,t.jsxs)("td",{className:"dbvc-resolver-rules__actions",children:[(0,t.jsx)("button",{type:"button",className:"button-link",onClick:()=>z(e),children:"Edit"}),(0,t.jsx)("button",{type:"button",className:"button-link-delete",onClick:()=>(async e=>{if(window.confirm(`Delete global rule for original ID ${e}?`))try{await l(`resolver-rules/${encodeURIComponent(e)}`),h(e=>e+1)}catch(e){window.alert(e.message)}})(e.original_id),children:"Delete"})]})]},e.original_id)})})]}),(0,t.jsxs)("div",{className:"dbvc-resolver-rules__bulk",children:[(0,t.jsx)("button",{type:"button",className:"button button-primary",onClick:()=>z(null),children:"Add Rule"}),(0,t.jsx)("button",{type:"button",className:"button",onClick:()=>{M.current&&M.current.click()},disabled:A,children:A?"Importing…":"Import CSV"}),(0,t.jsx)("button",{type:"button",className:"button button-secondary",onClick:async()=>{const e=Object.entries(m).filter(([,e])=>e).map(([e])=>e);if(e.length){if(window.confirm(`Delete ${e.length} selected rule(s)?`))try{await a("resolver-rules/bulk-delete",{original_ids:e}),v({}),f(!1),h(e=>e+1)}catch(e){window.alert(e.message)}}else window.alert("Select at least one rule to delete.")},disabled:!Object.values(m).some(Boolean),children:"Delete Selected"}),(0,t.jsx)("button",{type:"button",className:"button button-link",onClick:()=>{const e=["original_id,action,target_id,note,saved_at"].concat(s.map(e=>{var s;return[e.original_id,e.action,null!==(s=e.target_id)&&void 0!==s?s:"",(e.note||"").replace(/"/g,'""'),e.saved_at].join(",")})).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="dbvc-resolver-rules.csv",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},children:"Export CSV"}),(0,t.jsx)("input",{ref:M,type:"file",accept:".csv,text/csv",style:{display:"none"},onChange:async e=>{const s=e.target.files&&e.target.files[0];s&&(await(async e=>{I(!0),E({imported:0,errors:[]});try{var s;const t=(e=>{const s=e.replace(/\r\n/g,"\n").split("\n").map(e=>e.trim()).filter(e=>e.length>0).map(e=>(e=>{const s=[];let t="",n=!1;for(let i=0;i<e.length;i++){const a=e[i];'"'===a?n&&'"'===e[i+1]?(t+='"',i++):n=!n:","!==a||n?t+=a:(s.push(t),t="")}return s.push(t),s})(e));if(!s.length)return[];let t=s[0].map(e=>e.trim().toLowerCase()),n=s.slice(1);t.includes("original_id")||(t=["original_id","action","target_id","note"],n=s);const i=new Set(["original_id","action","target_id","note"]),a=t.map((e,s)=>i.has(e)?e:`col_${s}`);return n.map(e=>{const s={};return a.forEach((t,n)=>{var i;s[t]=null!==(i=e[n])&&void 0!==i?i:""}),s}).map(e=>{const s=parseInt(e.original_id,10),t=parseInt(e.target_id,10);return{original_id:Number.isFinite(s)?s:null,action:(e.action||"").toLowerCase(),target_id:Number.isFinite(t)?t:null,note:e.note||""}}).filter(e=>e.original_id&&e.action)})(await e.text());if(!t.length)return void E({imported:0,errors:["The CSV file does not contain any valid rows."]});const n=await a("resolver-rules/import",{rules:t}),i=n.imported?n.imported.length:0;E({imported:i,errors:null!==(s=n.errors)&&void 0!==s?s:[]}),h(e=>e+1)}catch(e){E({imported:0,errors:[e?.message||"Import failed."]})}finally{I(!1)}})(s),e.target.value="")}})]}),g&&(0,t.jsxs)("form",{className:"dbvc-resolver-rule-form",onSubmit:async e=>{e.preventDefault(),N("");const s=parseInt(y.original_id,10);if(!Number.isFinite(s)||s<=0)return void N("Enter a valid original media ID.");if(!x&&L)return void N("A rule already exists for that original media ID. Choose Edit instead.");if(!y.action)return void N("Select an action for this rule.");const t="reuse"===y.action||"map"===y.action,n=parseInt(y.target_id,10);if(t&&(!Number.isFinite(n)||n<=0))N("Enter a target attachment ID for reuse/map actions.");else if(t&&V)N("This attachment ID is already mapped to another rule.");else{S(!0);try{await a("resolver-rules",{original_id:s,action:y.action,target_id:t?n:null,note:y.note}),h(e=>e+1),t&&Number.isFinite(n)&&n>0&&(P.current=String(n)),K()}catch(e){N(e?.message||"Failed to save rule.")}finally{S(!1)}}},children:[(0,t.jsx)("h3",{children:x?"Edit global rule":"Add global rule"}),(0,t.jsxs)("div",{className:"dbvc-resolver-controls",children:[(0,t.jsx)("input",{type:"number",min:"1",placeholder:"Original ID",value:y.original_id,onChange:e=>H("original_id",e.target.value),readOnly:!!x}),L&&(0,t.jsx)("span",{className:"dbvc-field-hint is-warning",children:"Rule already exists for this media ID."}),(0,t.jsxs)("select",{value:y.action,onChange:e=>H("action",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select action…"}),(0,t.jsx)("option",{value:"reuse",children:"Reuse existing"}),(0,t.jsx)("option",{value:"download",children:"Download new"}),(0,t.jsx)("option",{value:"map",children:"Map to attachment ID"}),(0,t.jsx)("option",{value:"skip",children:"Skip"})]}),("reuse"===y.action||"map"===y.action)&&(0,t.jsx)("input",{type:"number",min:"1",placeholder:"Target attachment ID",value:y.target_id,onChange:e=>H("target_id",e.target.value)}),V&&(0,t.jsx)("span",{className:"dbvc-field-hint is-warning",children:"This attachment ID is already used by another rule."}),(0,t.jsx)("textarea",{value:y.note,onChange:e=>H("note",e.target.value),placeholder:"Optional note",rows:2})]}),k&&(0,t.jsx)("div",{className:"notice notice-error",children:(0,t.jsx)("p",{children:k})}),(0,t.jsxs)("div",{className:"dbvc-resolver-rule-form__actions",children:[(0,t.jsx)("button",{type:"button",className:"button button-link",onClick:K,children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"button button-primary",disabled:C,children:C?"Saving…":x?"Update Rule":"Save Rule"})]})]}),(R.imported>0||R.errors.length>0)&&(0,t.jsxs)("div",{className:"dbvc-resolver-import",children:[R.imported>0&&(0,t.jsx)("div",{className:"notice notice-success",children:(0,t.jsxs)("p",{children:[R.imported," rule(s) imported successfully."]})}),R.errors.length>0&&(0,t.jsxs)("div",{className:"notice notice-warning",children:[(0,t.jsx)("p",{children:"Import completed with warnings:"}),(0,t.jsx)("ul",{children:R.errors.map((e,s)=>(0,t.jsx)("li",{children:n(e)},s))})]})]})]})]})}}},t={};function n(e){var i=t[e];if(void 0!==i)return i.exports;var a=t[e]={exports:{}};return s[e](a,a.exports,n),a.exports}n.m=s,e=[],n.O=(s,t,i,a)=>{if(!t){var l=1/0;for(d=0;d<e.length;d++){for(var[t,i,a]=e[d],r=!0,o=0;o<t.length;o++)(!1&a||l>=a)&&Object.keys(n.O).every(e=>n.O[e](t[o]))?t.splice(o--,1):(r=!1,a<l&&(l=a));if(r){e.splice(d--,1);var c=i();void 0!==c&&(s=c)}}return s}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[t,i,a]},n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e={378:0,681:0};n.O.j=s=>0===e[s];var s=(s,t)=>{var i,a,[l,r,o]=t,c=0;if(l.some(s=>0!==e[s])){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(o)var d=o(n)}for(s&&s(t);c<l.length;c++)a=l[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},t=globalThis.webpackChunkdb_version_control_admin_app=globalThis.webpackChunkdb_version_control_admin_app||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})();var i=n.O(void 0,[681],()=>n(435));i=n.O(i)})()}},s={};function t(n){var i=s[n];if(void 0!==i)return i.exports;var a=s[n]={exports:{}};return e[n](a,a.exports,t),a.exports}t.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},t.d=(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{"use strict";t(766)})()})()},976:(e,s,t)=>{"use strict";t(766)}},t={};function n(e){var i=t[e];if(void 0!==i)return i.exports;var a=t[e]={exports:{}};return s[e](a,a.exports,n),a.exports}n.m=s,e=[],n.O=(s,t,i,a)=>{if(!t){var l=1/0;for(d=0;d<e.length;d++){for(var[t,i,a]=e[d],r=!0,o=0;o<t.length;o++)(!1&a||l>=a)&&Object.keys(n.O).every(e=>n.O[e](t[o]))?t.splice(o--,1):(r=!1,a<l&&(l=a));if(r){e.splice(d--,1);var c=i();void 0!==c&&(s=c)}}return s}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[t,i,a]},n.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return n.d(s,{a:s}),s},n.d=(e,s)=>{for(var t in s)n.o(s,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e={378:0,681:0};n.O.j=s=>0===e[s];var s=(s,t)=>{var i,a,[l,r,o]=t,c=0;if(l.some(s=>0!==e[s])){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(o)var d=o(n)}for(s&&s(t);c<l.length;c++)a=l[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},t=globalThis.webpackChunkdb_version_control_admin_app=globalThis.webpackChunkdb_version_control_admin_app||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))})();var i=n.O(void 0,[681],()=>n(976));i=n.O(i)})();